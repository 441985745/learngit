<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.opple.fa.assetcard.dao.MeasuringInstrumentsDAO">

    <!-- oracle 分页头 -->
    <sql id="pagination_Head" >
        <![CDATA[select * from ( select row_.*, rownum rownum_ from ( ]]>
    </sql>
    <!-- oracle 分页尾 -->
    <sql id="pagination_Tail">
        <![CDATA[) row_ where rownum <= #{pager.pageSize}* #{pager.offset} ) where rownum_ >= #{pager.firstResult} + 1]]>
    </sql>
    <!-- count * from -->
	<sql id="count_Start_Head">
		<![CDATA[select count(*) from ( ]]>
	</sql>
	<sql id="count_Start_Tail">
		<![CDATA[) countObj ]]>
	</sql>
	<resultMap id="meterRegulatorMap" type="com.opple.fa.assetcard.entity.MeasuringInstruments">
        <result property="id" column="ID"/>
  		<result property="createBy" column="CREATE_BY"/>
  		<result property="createDate" column="CREATE_DATE"/>
  		<result property="updateBy" column="UPDATE_BY"/>
  		<result property="updateDate" column="UPDATE_DATE"/>
  		<result property="deletedFlag" column="DELETED_FLAG"/>
  		
  		<result property="managementCode" column="MANAGEMENT_CODE"/>
  		<result property="facrotyNumber" column="FACROTY_NUMBER"/>
  		<result property="managementLevel" column="MANAGEMENT_LEVEL"/>
  		<result property="enableDate" column="ENABLE_DATE"/>
  		<result property="inspectionDate" column="INSPECTION_DATE"/>
  		<result property="warrantyPeriod" column="WARRANTY_PERIOD"/>
  		<result property="verificationCycle" column="VERIFICATION_CYCLE"/>
  		<result property="contactNumaer" column="CONTACT_NUMBER"/>
  		<result property="approvedEffectiveDate" column="APPROVED_EFFECTIVE_DATE"/>
		<result property="purchaseId" column="PURCHASE_ID"/>
  		<result property="checkAcceptId" column="CHECK_ACCEPT_ID"/>
		<result property="isThirdReport" column="IS_THIRD_REPORT"/>
		<result property="reportUpload" column="REPORT_UPLOAD"/>
		<result property="actualDateAcceptance" column="ACTUAL_DATE_ACCEPTANCE"/>
		<result property="currentYearNoDepreciation" column="CURRENT_YEAR_NO_DEPRECIATION"/>
  		<result property="monthCountingDepreciation" column="MONTH_COUNTING_DEPRECIATION"/>
  		<result property="currentYearDepreciation" column="CURRENT_YEAR_DEPRECIATION"/>
  		<result property="currentYearMonths" column="CURRENT_YEAR_MONTHS"/>
  		
  		<result property="calibrationDate" column="CALIBRATION_DATE"/>
  		<result property="nextCalibrationDate" column="NEXT_CALIBRATION_DATE"/>
  		<result property="calibrationUnit" column="CALIBRATION_UNIT"/>
  		<result property="accuracyClass" column="ACCURACY_CLASS"/>
  		<result property="manufactureFactory" column="MANUFACTURE_FACTORY"/>

	</resultMap>
	
	<sql id="tb_fa_measuring_instruments">
		SELECT tb_fa_measuring_instruments_.ID,
			tb_fa_measuring_instruments_.CREATE_BY,
			tb_fa_measuring_instruments_.CREATE_DATE,
			tb_fa_measuring_instruments_.UPDATE_BY,
			tb_fa_measuring_instruments_.UPDATE_DATE,
			tb_fa_measuring_instruments_.DELETED_FLAG,
			tb_fa_measuring_instruments_.MANAGEMENT_CODE,
			tb_fa_measuring_instruments_.FACROTY_NUMBER,
			tb_fa_measuring_instruments_.MANAGEMENT_LEVEL,
			tb_fa_measuring_instruments_.ENABLE_DATE,
			tb_fa_measuring_instruments_.INSPECTION_DATE,
			tb_fa_measuring_instruments_.WARRANTY_PERIOD,
			tb_fa_measuring_instruments_.VERIFICATION_CYCLE,
			tb_fa_measuring_instruments_.CONTACT_NUMBER,
			tb_fa_measuring_instruments_.APPROVED_EFFECTIVE_DATE,
			tb_fa_measuring_instruments_.PURCHASE_ID,
			tb_fa_measuring_instruments_.CHECK_ACCEPT_ID,
			tb_fa_measuring_instruments_.IS_THIRD_REPORT,
			tb_fa_measuring_instruments_.REPORT_UPLOAD,
			tb_fa_measuring_instruments_.ACTUAL_DATE_ACCEPTANCE,
			tb_fa_measuring_instruments_.CURRENT_YEAR_NO_DEPRECIATION,
			tb_fa_measuring_instruments_.MONTH_COUNTING_DEPRECIATION,
			tb_fa_measuring_instruments_.CURRENT_YEAR_DEPRECIATION,
			tb_fa_measuring_instruments_.CURRENT_YEAR_MONTHS,
			tb_fa_measuring_instruments_.CALIBRATION_DATE,
			tb_fa_measuring_instruments_.NEXT_CALIBRATION_DATE,
			tb_fa_measuring_instruments_.CALIBRATION_UNIT,
			tb_fa_measuring_instruments_.ACCURACY_CLASS,
			tb_fa_measuring_instruments_.MANUFACTURE_FACTORY
			

			FROM TB_FA_MEASURING_INSTRUMENTS tb_fa_measuring_instruments_
	</sql>
	
	
	<select id="searchMeasuringInstruments" resultMap="meterRegulatorMap">
		<include refid="tb_fa_measuring_instruments"></include>
		<if test="measuringInstruments.id !=null and measuringInstruments.id !=''">
			WHERE tb_fa_measuring_instruments_.ID = #{measuringInstruments.id}
			AND tb_fa_measuring_instruments_.DELETED_FLAG = 0
		</if>
	
	</select>
	<insert id="insertMeasuringInstruments" keyProperty="id" useGeneratedKeys="true" parameterType="com.opple.fa.assetcard.entity.MeasuringInstruments">
	<selectKey keyProperty="id"  order="BEFORE" resultType="long">
		select seq_measuring_instruments.nextval as id from dual
	</selectKey>
		insert into TB_FA_MEASURING_INSTRUMENTS
		(
			ID,
			CREATE_BY,
			CREATE_DATE,
			UPDATE_BY,
			UPDATE_DATE,
			DELETED_FLAG,
			MANAGEMENT_CODE,
			FACROTY_NUMBER,
			MANAGEMENT_LEVEL,
			ENABLE_DATE,
			INSPECTION_DATE,
			WARRANTY_PERIOD,
			VERIFICATION_CYCLE,
			CONTACT_NUMBER,
			APPROVED_EFFECTIVE_DATE,
			PURCHASE_ID,
			CHECK_ACCEPT_ID,
			IS_THIRD_REPORT,
			REPORT_UPLOAD,
			ACTUAL_DATE_ACCEPTANCE,
			DEMAND_ORDER_ID,
			APPLY_ORDER_ID,
			CURRENT_YEAR_NO_DEPRECIATION,
			MONTH_COUNTING_DEPRECIATION,
			CURRENT_YEAR_DEPRECIATION,
			CURRENT_YEAR_MONTHS,
			CALIBRATION_DATE,
			NEXT_CALIBRATION_DATE,
			CALIBRATION_UNIT,
			ACCURACY_CLASS,
			MANUFACTURE_FACTORY

		)
		values
		(
			#{id},
			#{createBy},
			#{createDate},
			#{updateBy},
			#{updateDate},
			'0',
			#{managementCode},
			#{facrotyNumber},
			#{managementLevel},
			#{enableDate},
			#{inspectionDate},
			#{warrantyPeriod},
			#{verificationCycle},
			#{contactNumaer},
			#{approvedEffectiveDate},
			#{purchaseId},
			#{checkAcceptId},
			#{isThirdReport},
			#{reportUpload},
			#{actualDateAcceptance},
			#{demandId},
			#{applyId},
			#{currentYearNoDepreciation},
			#{monthCountingDepreciation},
			#{currentYearDepreciation},
			#{currentYearMonths},
			#{calibrationDate},
			#{nextCalibrationDate},
			#{calibrationUnit},
			#{accuracyClass},
			#{manufactureFactory}
		)
	</insert>


	<update id="updateMeasuringInstrumentsCard" parameterType="com.opple.fa.assetcard.entity.MeasuringInstruments">
		update TB_FA_MEASURING_INSTRUMENTS
		<trim prefix="SET" suffixOverrides=",">
		
            MANAGEMENT_CODE	= #{managementCode}, --	管理编号
   
		<if test="null != facrotyNumber and '' != facrotyNumber">
            FACROTY_NUMBER	= #{facrotyNumber},--出厂编号
        </if>

        <if test="null != managementLevel and '' != managementLevel">
            MANAGEMENT_LEVEL=#{managementLevel},			--管理级别
        </if>

        <if test="null != isThirdReport and '' != isThirdReport">
            IS_THIRD_REPORT	=#{isThirdReport},--是否有第三方检验报告0是  1是否
        </if>

        <if test="null != inspectionDate and '' != inspectionDate">
            INSPECTION_DATE =#{inspectionDate},	--		验收日期
        </if>

        <if test="null != manufactureFactory and '' != manufactureFactory">
            MANUFACTURE_FACTORY=#{manufactureFactory},
        </if>
        <if test="null != accuracyClass and '' != accuracyClass">
            ACCURACY_CLASS=#{accuracyClass},
        </if>

        <if test="null != verificationCycle and '' != verificationCycle">
            VERIFICATION_CYCLE=#{verificationCycle},
        </if>

        <if test="null != calibrationDate and '' != calibrationDate">
            CALIBRATION_DATE=#{calibrationDate},
        </if>

        <if test="null != nextCalibrationDate and '' != nextCalibrationDate">
            NEXT_CALIBRATION_DATE=#{nextCalibrationDate},
        </if>

        <if test="null != calibrationUnit and '' != calibrationUnit">
            CALIBRATION_UNIT=#{calibrationUnit},
        </if>
		</trim>
		where ID=#{id}
	</update>
	<update id="updateMeasuringInstrumentsCard1" parameterType="com.opple.fa.assetcard.entity.MeasuringInstruments">
		update TB_FA_MEASURING_INSTRUMENTS
		set

				MANAGEMENT_CODE	= #{managementCode} --	管理编号

			<if test="null != facrotyNumber and '' != facrotyNumber">
				,FACROTY_NUMBER	= #{facrotyNumber}--出厂编号
			</if>

			<if test="null != managementLevel and '' != managementLevel">
				,MANAGEMENT_LEVEL=#{managementLevel}			--管理级别
			</if>

			<if test="null != isThirdReport and '' != isThirdReport">
				,IS_THIRD_REPORT	=#{isThirdReport} --是否有第三方检验报告0是  1是否
			</if>

			<if test="null != inspectionDate and '' != inspectionDate">
				,INSPECTION_DATE =#{inspectionDate} 	--		验收日期
			</if>

			<if test="null != manufactureFactory and '' != manufactureFactory">
				,MANUFACTURE_FACTORY=#{manufactureFactory}
			</if>
			<if test="null != accuracyClass and '' != accuracyClass">
				,ACCURACY_CLASS=#{accuracyClass}
			</if>

			<if test="null != verificationCycle and '' != verificationCycle">
				,VERIFICATION_CYCLE=#{verificationCycle}
			</if>

			<if test="null != calibrationDate and '' != calibrationDate">
				,CALIBRATION_DATE=#{calibrationDate}
			</if>

			<if test="null != nextCalibrationDate and '' != nextCalibrationDate">
				,NEXT_CALIBRATION_DATE=#{nextCalibrationDate}
			</if>

			<if test="null != calibrationUnit and '' != calibrationUnit">
				,CALIBRATION_UNIT=#{calibrationUnit}
			</if>

		where ID=#{id}
	</update>

	<update id="updateMeasuringInstrumentsCard2" parameterType="com.opple.fa.assetcard.entity.MeasuringInstruments">
		update TB_FA_MEASURING_INSTRUMENTS
		set
				MANAGEMENT_CODE	= #{managementCode}, --	管理编号
				FACROTY_NUMBER	= #{facrotyNumber},--出厂编号
				MANAGEMENT_LEVEL=#{managementLevel},			--管理级别
				IS_THIRD_REPORT	=#{isThirdReport},--是否有第三方检验报告0是  1是否
				INSPECTION_DATE =#{inspectionDate},	--		验收日期
				MANUFACTURE_FACTORY=#{manufactureFactory},
				ACCURACY_CLASS=#{accuracyClass},
				VERIFICATION_CYCLE=#{verificationCycle},
				CALIBRATION_DATE=#{calibrationDate},
				NEXT_CALIBRATION_DATE=#{nextCalibrationDate},
				CALIBRATION_UNIT=#{calibrationUnit}
		where ID=#{id}
	</update>
	<update id="deleteMeasuringInstruments" >
		update TB_FA_MEASURING_INSTRUMENTS
		set deleted_flag='1'
		where id=#{id}
	</update>
	<update id="updateLeadingMeasuringInstruments" parameterType="com.opple.fa.assetcard.entity.MeasuringInstruments">
		update TB_FA_MEASURING_INSTRUMENTS set
		FACROTY_NUMBER=#{facrotyNumber},
		MANAGEMENT_CODE=#{managementCode},
		MANUFACTURE_FACTORY=#{manufactureFactory},
		MANAGEMENT_LEVEL=#{managementLevel},
		ACCURACY_CLASS=#{accuracyClass},
		VERIFICATION_CYCLE=#{verificationCycle},
		CALIBRATION_DATE=#{calibrationDate},
		NEXT_CALIBRATION_DATE=#{nextCalibrationDate},
		CALIBRATION_UNIT=#{calibrationUnit},
		IS_THIRD_REPORT=#{isThirdReport}
		where ID=#{id}
	</update>

</mapper>

