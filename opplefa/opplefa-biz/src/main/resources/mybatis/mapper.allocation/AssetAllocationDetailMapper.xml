<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.opple.fa.allocation.dao.AssetAllocationDetailDAO">
    <!-- oracle 分页头 -->
    <sql id="pagination_Head" >
        <![CDATA[select * from ( select row_.*, rownum rownum_ from ( ]]>
    </sql>
    <!-- oracle 分页尾 -->
    <sql id="pagination_Tail">
        <![CDATA[) row_ where rownum <= #{pager.pageSize}* #{pager.offset} ) where rownum_ >= #{pager.firstResult} + 1]]>
    </sql>
    <!-- count * from -->
	<sql id="count_Start_Head">
		<![CDATA[select count(*) from ( ]]>
	</sql>
	<sql id="count_Start_Tail">
		<![CDATA[) countObj ]]>
	</sql>
	<resultMap id="assetAllocationDetailMap" type="com.opple.fa.allocation.entity.AssetAllocationDetail">
        <result property="id" column="ID"/>
        <result property="createBy" column="CREATE_BY"/>
        <result property="createDate" column="CREATE_DATE"/>
        <result property="updateBy" column="UPDATE_BY" />
		<result property="updateDate" column="UPDATE_DATE" />
        <result property="deletedFlag" column="DELETED_FLAG"/>
        <result property="assetAllocationId" column="ASSET_ALLOCATION_ID"/>
        <result property="generalAssetId" column="GENERAL_ASSET_ID"/>
        <result property="assetCode" column="ASSET_CODE"/>
        <result property="assetName" column="ASSET_NAME"/>
		<result property="putUnderManageCode" column="PUT_UNDER_MANAGE_CODE"/>
		<result property="assetPerson" column="ASSET_PERSON"/>
		<result property="companyName" column="COMPANY_NAME"/>	
		<result property="specificationModel" column="SPECIFICATION_MODEL"/>
		<result property="assetOriginalValue" column="ASSET_ORIGINAL_VALUE"/>
		<result property="assetNetValue" column="ASSET_NET_VALUE"/>
		<result property="assetState" column="ASSET_STATE"/>
		<result property="useState" column="USE_STATE"/>
		<result property="persentDepartment" column="PERSENT_DEPARTMENT"/>
		<result property="location" column="LOCATION"/>
		<result property="newAssetCode" column="NEW_ASSET_CODE"/>
		<result property="oldAccountancyVouche" column="OLD_ACCOUNTANCY_VOUCHER"/>
		<result property="nowAccountancyVoucher" column="NOW_ACCOUNTANCY_VOUCHER"/>
		<result property="oldAccountYear" column="OLD_ACCOUNT_YEAR"/>
		<result property="nowAccountYear" column="NOW_ACCOUNT_YEAR"/>
		<result property="assetType" column="ASSET_TYPE"/>
		<result property="costCenterCode" column="COST_CENTER_CODE"/>
		<result property="companyCode" column="COMPANY_CODE"/>
	</resultMap>

	<sql id="search_assetAllocationDetail" >
        <![CDATA[
              SELECT
                   asset_Allocation_Detail_.ID,
                   asset_Allocation_Detail_.CREATE_BY,
                   asset_Allocation_Detail_.CREATE_DATE,
                   asset_Allocation_Detail_.UPDATE_BY,
                   asset_Allocation_Detail_.UPDATE_DATE,
                   asset_Allocation_Detail_.DELETED_FLAG,
                   asset_Allocation_Detail_.ASSET_ALLOCATION_ID,
                   asset_Allocation_Detail_.GENERAL_ASSET_ID,
                   asset_Allocation_Detail_.ASSET_CODE,
                   asset_Allocation_Detail_.ASSET_NAME,
                   asset_Allocation_Detail_.PUT_UNDER_MANAGE_CODE,
                   
                   asset_Allocation_Detail_.ASSET_PERSON,
                   asset_Allocation_Detail_.COMPANY_NAME,
                   asset_Allocation_Detail_.SPECIFICATION_MODEL,
                   asset_Allocation_Detail_.ASSET_ORIGINAL_VALUE,
                   asset_Allocation_Detail_.ASSET_NET_VALUE,
                   asset_Allocation_Detail_.ASSET_STATE,
                   asset_Allocation_Detail_.USE_STATE,
                   asset_Allocation_Detail_.PERSENT_DEPARTMENT,
                   asset_Allocation_Detail_.LOCATION,
                   asset_Allocation_Detail_.NEW_ASSET_CODE,
                   asset_Allocation_Detail_.OLD_ACCOUNTANCY_VOUCHER,
                   asset_Allocation_Detail_.NOW_ACCOUNTANCY_VOUCHER,
                   asset_Allocation_Detail_.OLD_ACCOUNT_YEAR,
                   asset_Allocation_Detail_.NOW_ACCOUNT_YEAR,
                   asset_Allocation_Detail_.ASSET_TYPE
      
                FROM
                   TB_FA_ASSET_ALLOCATION_DETAIL asset_Allocation_Detail_
        ]]>
    </sql>
    
    <select id="searchAssetAllocationDetailById" resultMap="assetAllocationDetailMap">
    	SELECT
       ID,
       DELETED_FLAG,
       ASSET_ALLOCATION_ID,
       GENERAL_ASSET_ID,
       ASSET_CODE,
       ASSET_NAME,
       PUT_UNDER_MANAGE_CODE,
       ASSET_PERSON,
       COMPANY_NAME,
       SPECIFICATION_MODEL,
       ASSET_ORIGINAL_VALUE,
       ASSET_NET_VALUE,
       ASSET_STATE,
       USE_STATE,
       PERSENT_DEPARTMENT,
       LOCATION,
       NEW_ASSET_CODE,
       OLD_ACCOUNTANCY_VOUCHER,
       NOW_ACCOUNTANCY_VOUCHER,
       OLD_ACCOUNT_YEAR,
       NOW_ACCOUNT_YEAR,
       ASSET_TYPE

      FROM TB_FA_ASSET_ALLOCATION_DETAIL 
      where ASSET_ALLOCATION_ID = ${assetAllocationId} AND  DELETED_FLAG=0 order by ID desc
    
    </select>
    <update id="updateAssetAllocationDetail" parameterType="com.opple.fa.allocation.entity.AssetAllocationDetail">
    		update TB_FA_ASSET_ALLOCATION_DETAIL set DELETED_FLAG=1 where ASSET_ALLOCATION_ID=#{assetAllocationId}
    </update>
    <insert id="saveApply">
    	INSERT INTO TB_FA_ASSET_ALLOCATION_DETAIL
		  (	ID,
		  DELETED_FLAG,
		  ASSET_ALLOCATION_ID,
		  GENERAL_ASSET_ID,
		  ASSET_CODE,
		  ASSET_NAME,
		  PUT_UNDER_MANAGE_CODE,
		  ASSET_PERSON,             
		  COMPANY_NAME,
		  SPECIFICATION_MODEL,
		  ASSET_ORIGINAL_VALUE,
		  ASSET_NET_VALUE,
		  ASSET_STATE,
		  USE_STATE,
		  PERSENT_DEPARTMENT,
		  LOCATION,
		  ASSET_TYPE,
		  COST_CENTER_CODE,
		  COMPANY_CODE

			)   
	     VALUES
	      ( 
	      	seq_asset_allocation_detail.nextval,  
	        0, 
	        #{assetAllocationId}, 
	        #{generalAssetId},
	        #{assetCode},
	        #{assetName},
	        #{putUnderManageCode},
	        #{assetPerson},
	        #{companyName},
	        #{specificationModel},
	        #{assetOriginalValue},
	        #{assetNetValue},
            #{assetState},
            #{useState},
	        #{persentDepartment},
	        #{location},
	        #{assetType},
	        #{costCenterCode},
	        #{companyCode}
	        )
    </insert>
    <select id="searchAssetAllocationDetail" resultMap="assetAllocationDetailMap">
    	<include refid="search_assetAllocationDetail"></include>
    	WHERE asset_Allocation_Detail_.GENERAL_ASSET_ID=#{id}
    	AND asset_Allocation_Detail_.DELETED_FLAG=0
    </select>
    
    <select id="serachAssetAllocationDetail" resultMap="assetAllocationDetailMap">
		select ID,
		CREATE_BY,
		CREATE_DATE,
		UPDATE_BY,
		UPDATE_DATE,
		ASSET_ALLOCATION_ID,
		GENERAL_ASSET_ID,
    	COMPANY_NAME,
       SPECIFICATION_MODEL,
       ASSET_ORIGINAL_VALUE,
       ASSET_NET_VALUE,
       ASSET_STATE,
       USE_STATE,
       PERSENT_DEPARTMENT,
       LOCATION,
       NEW_ASSET_CODE,
       OLD_ACCOUNTANCY_VOUCHER,
       NOW_ACCOUNTANCY_VOUCHER,
       OLD_ACCOUNT_YEAR,
       NOW_ACCOUNT_YEAR
		from TB_FA_ASSET_ALLOCATION_DETAIL where DELETED_FLAG=0 AND ASSET_ALLOCATION_ID=#{assetAllocationId}
	</select>

  	<update id="updateAllocationDetailById" parameterType="com.opple.fa.allocation.entity.AssetAllocationDetail">
  		update TB_FA_ASSET_ALLOCATION_DETAIL set
  		OLD_ACCOUNTANCY_VOUCHER=#{oldAccountancyVouche},
  		NOW_ACCOUNTANCY_VOUCHER=#{nowAccountancyVoucher},
  		OLD_ACCOUNT_YEAR=#{oldAccountYear},
  		NOW_ACCOUNT_YEAR=#{nowAccountYear}
  		WHERE ID=#{id}
  	</update>
  	<update id="updateAllocationDetailNewCode" parameterType="com.opple.fa.allocation.entity.AssetAllocationDetail">
  	    update TB_FA_ASSET_ALLOCATION_DETAIL set  NEW_ASSET_CODE=#{newAssetCode}  where ASSET_ALLOCATION_ID=#{assetAllocationId} and GENERAL_ASSET_ID=#{generalAssetId}  AND DELETED_FLAG='0'
  	</update>
  	<select id="serachAssetCardIds" resultType="String" parameterType="com.opple.fa.allocation.entity.AssetAllocationDetail">
  		select GENERAL_ASSET_ID from TB_FA_ASSET_ALLOCATION_DETAIL where DELETED_FLAG='0' and ASSET_ALLOCATION_ID=#{assetAllocationId}
  	</select>
</mapper>

