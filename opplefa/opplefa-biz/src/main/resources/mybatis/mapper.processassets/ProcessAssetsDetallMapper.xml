<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.opple.fa.processasset.dao.ProcessAssetsDetallDAO">
    <!-- oracle 分页头 -->
    <sql id="pagination_Head" >
        <![CDATA[select * from ( select row_.*, rownum rownum_ from ( ]]>
    </sql>
    <!-- oracle 分页尾 -->
    <sql id="pagination_Tail">
        <![CDATA[) row_ where rownum <= #{pager.pageSize}* #{pager.offset} ) where rownum_ >= #{pager.firstResult} + 1]]>
    </sql>
    <!-- count * from -->
	<sql id="count_Start_Head">
		<![CDATA[select count(*) from ( ]]>
	</sql>
	<sql id="count_Start_Tail">
		<![CDATA[) countObj ]]>
	</sql>
	<resultMap id="processAssetsDetallMap" type="com.opple.fa.processasset.entity.ProcessAssetsDetall">
        <result property="id" column="ID"/>
        <result property="createBy" column="CREATE_BY"/>
        <result property="createDate" column="CREATE_DATE"/>
        <result property="updateBy" column="UPDATE_BY"/>
        <result property="updateDate" column="UPDATE_DATE"/>
        <result property="status" column="STATUS"/>
        <result property="processAssetsId" column="PROCESS_ASSETS_ID"/>
        <result property="generalAssetId" column="GENERAL_ASSET_ID"/>
	</resultMap>
	
	<sql id="process_Assets_Detall" >
        <![CDATA[
               SELECT
			     ID,
			     CREATE_BY,
			     CREATE_DATE,
			     UPDATE_BY,
			     UPDATE_DATE,
			     STATUS,
			     PROCESS_ASSETS_ID,
			     GENERAL_ASSET_ID
			     
			  FROM
			     Tb_Fa_Process_Assets_Detall 
        ]]>
    </sql>
    
    <update id="updateStatus" parameterType="long">
    	update Tb_Fa_Process_Assets_Detall set 
    	STATUS='1' where PROCESS_ASSETS_ID=#{processAssetsId}
    </update>
    
    <select id="getProcessAssetsDetall" resultMap="processAssetsDetallMap" >
    	
    	<include refid="process_Assets_Detall"/>
    	WHERE STATUS = '0' AND PROCESS_ASSETS_ID = #{processAssetsDetall.processAssetsId}
    
    </select>
    
    <insert id="saveProcessAssetsDetall" parameterType="com.opple.fa.processasset.entity.ProcessAssetsDetall"> 
    	
    	insert into TB_FA_PROCESS_ASSETS_DETALL
    	(
    		 ID,
		     CREATE_BY,
		     CREATE_DATE,
		     UPDATE_BY,
		     UPDATE_DATE,
		     STATUS,
		     PROCESS_ASSETS_ID,
		     GENERAL_ASSET_ID
    	)
    	values
    	(
    		seq_process_assets_detall.nextval,
    		#{processAssetsDetall.createBy},
    		#{processAssetsDetall.createDate},
    		#{processAssetsDetall.updateBy},
    		#{processAssetsDetall.updateDate},
    		'0',
    		#{processAssetsDetall.processAssetsId},
    		#{processAssetsDetall.generalAssetId}

    	)
    	
    
    </insert>
    <select id="searchProcessAssetsDetall" resultMap="processAssetsDetallMap" parameterType="com.opple.fa.processasset.entity.ProcessAssetsDetall">
    	select  ID,
		     CREATE_BY,
		     CREATE_DATE,
		     UPDATE_BY,
		     UPDATE_DATE,
		     STATUS,
		     PROCESS_ASSETS_ID,
		     GENERAL_ASSET_ID
		     from TB_FA_PROCESS_ASSETS_DETALL where PROCESS_ASSETS_ID=#{processAssetsId}
    </select>
       <select id="searchProcessAssetsDetallById" resultType="String" parameterType="com.opple.fa.processasset.entity.ProcessAssetsDetall">
    	select  
		     GENERAL_ASSET_ID
		     from TB_FA_PROCESS_ASSETS_DETALL where PROCESS_ASSETS_ID=#{processAssetsId} and STATUS='0'
    </select>
</mapper>