<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.opple.fa.report.dao.FullProcessDAO">
    <!-- oracle 分页头 -->
    <sql id="pagination_Head">
        <![CDATA[
        select * from ( select row_.*, rownum rownum_ from (
        ]]>
    </sql>
    <!-- oracle 分页尾 -->
    <sql id="pagination_Tail">
        <![CDATA[
        ) row_ where rownum <= #{pager.pageSize}* #{pager.offset} ) where rownum_ >= #{pager.firstResult} + 1
        ]]>
    </sql>
    <!-- count * from -->
    <sql id="count_Start_Head">
		<![CDATA[
        select count(*) from (
        ]]>
	</sql>
    <sql id="count_Start_Tail">
		<![CDATA[
        ) countObj
        ]]>
	</sql>
    <resultMap id="fullProcessResultMap" type="com.opple.fa.report.entity.FullProcess">
        <result property="doId" column="do_Id"/>
        <result property="doApplyUser" column="do_Apply_User"/>
        <result property="doApplyDate" column="do_Apply_Date"/>
        <result property="doApplyDepartment" column="do_Apply_Department"/>
        <result property="projectProposal" column="project_proposal"/>
        <result property="entryName" column="entry_name"/>
        <result property="companyName" column="COMPANY_NAME"/>
        <result property="costCenterCode" column="COST_CENTER_CODE"/>
        <result property="costCenter" column="COST_CENTER"/>
        <result property="projectMoney" column="project_money"/>
        <result property="incomeAccountingMethod" column="income_accounting_method"/>
        <result property="annualIncomeAmount" column="annual_income_amount"/>
        <result property="paybackPeriodOfInvestment" column="payback_period_of_investment"/>
        <result property="projectType" column="project_type"/>
        <result property="doDemandCount" column="do_demand_count"/>
        <result property="doIamoney" column="iamoney"/>
        <result property="doCapprovalstate" column="capprovalstate"/>

        <result property="aoId" column="aoId"/>
        <result property="aoApplyUser" column="aoApplyUser"/>
        <result property="aoApplyDate" column="aoApplyDate"/>
        <result property="apApplyCount" column="ao_apply_count"/>
        <result property="aoIamoney" column="ao_iamoney"/>
        <result property="aoCapprovalstate" column="ao_capprovalstate"/>

        <result property="purchaseOrderId" column="PURCHASE_ORDER_ID"/>
        <result property="purchaseOrderSapId" column="PURCHASE_ORDER_SAP_ID"/>
        <result property="supplierName" column="SUPPLIER_NAME"/>
        <result property="currencyName" column="CURRENCY_NAME"/>
        <result property="taxRate" column="TAX_RATE"/>
        <result property="poApplyUser" column="PO_APPLY_USER"/>
        <result property="poApplyDate" column="PO_APPLY_DATE"/>
        <result property="poIamoney" column="PO_IAMONEY"/>
        <result property="poCapprovalstate" column="PO_CAPPROVALSTATE"/>
        <result property="poApplyCount" column="PO_APPLY_COUNT"/>

        <result property="receiveGoodsId" column="receive_goods_id"/>
        <result property="receiveDate" column="receive_date"/>
        <result property="receiveGoodsCount" column="receive_goods_count"/>

        <result property="checkAcceptId" column="check_accept_id"/>
        <result property="checkCount" column="check_count"/>
        <result property="caCapprovalstate" column="ca_capprovalstate"/>
        <result property="caCheckDate" column="ca_check_date"/>
        <result property="applyCheckUserName" column="apply_check_user_name"/>
        <result property="epMaterialdocument" column="ep_materialdocument"/>

    </resultMap>

    <sql id="search_receive_full_process_fragment">
        select vdo.*,
        vao.aoId,
        vao.aoApplyUser,
        vao.aoApplyDate,
        vao.ao_apply_count,
        vao.ao_iamoney,
        vao.ao_capprovalstate,
        vpo.PURCHASE_ORDER_ID,
        vpo.PURCHASE_ORDER_SAP_ID,
        vpo.SUPPLIER_NAME,
        vpo.CURRENCY_NAME,
        vpo.TAX_RATE,
        vpo.PO_APPLY_USER,
        vpo.PO_APPLY_DATE,
        vpo.PO_IAMONEY,
        vpo.PO_CAPPROVALSTATE,
        vpo.PO_APPLY_COUNT,
        vr.receive_goods_id,
        vr.receive_date,
        vr.receive_goods_count,
        va.check_accept_id,
        va.check_count,
        va.ca_capprovalstate,
        va.ca_check_date,
        va.apply_check_user_name,
        va.ep_materialdocument
        from V_FA_REPORT_DEMAND_ORDER vdo
        left join V_FA_REPORT_APPLY_ORDER vao
        on vdo.do_Id = vao.demand_order_id
        left join V_FA_REPORT_purchase_ORDER vpo
        on vpo.apply_order_id = vao.aoId
        and vpo.demand_order_id = vdo.do_Id
        left join V_FA_REPORT_receive vr
        on vr.demand_id = vdo.do_Id
        and vr.apply_order_id = vao.aoId
        and vr.purchase_id = vpo.PURCHASE_ORDER_ID
        left join V_FA_REPORT_acceptance va
        on va.demand_id = vdo.do_Id
        and va.apply_order_id = vao.aoId
        and va.purchase_id = vpo.PURCHASE_ORDER_ID
        and va.receive_goods_id = vr.receive_goods_id
        where 1 = 1
        <if test="fullProcess.doId != null and fullProcess.doId != ''">
            and vdo.do_Id LIKE '%' || #{fullProcess.doId} || '%'
        </if>
        <if test="fullProcess.aoId != null and fullProcess.aoId != ''">
            and vao.aoId LIKE '%' || #{fullProcess.aoId} || '%'
        </if>
        <if test="fullProcess.purchaseOrderId != null and fullProcess.purchaseOrderId != ''">
            and vpo.PURCHASE_ORDER_ID LIKE '%' || #{fullProcess.purchaseOrderId} || '%'
        </if>
        <if test="fullProcess.purchaseOrderSapId != null and fullProcess.purchaseOrderSapId != ''">
            and vpo.PURCHASE_ORDER_SAP_ID LIKE '%' || #{fullProcess.purchaseOrderSapId} || '%'
        </if>
        <if test="fullProcess.receiveGoodsId != null and fullProcess.receiveGoodsId != ''">
            and vr.receive_goods_id LIKE '%' || #{fullProcess.receiveGoodsId} || '%'
        </if>
        <if test="fullProcess.checkAcceptId != null and fullProcess.checkAcceptId != ''">
            and va.check_accept_id LIKE '%' || #{fullProcess.checkAcceptId} || '%'
        </if>
        <if test="fullProcess.doApplyUser != null and fullProcess.doApplyUser != ''">
            and vdo.do_Apply_User LIKE '%' || #{fullProcess.doApplyUser} || '%'
        </if>
        <if test="fullProcess.startDate != null and fullProcess.startDate != ''">
            <![CDATA[      and vdo.do_Apply_Date >= to_date(#{fullProcess.startDate}, 'yyyy-mm-dd')  ]]>
        </if>
        <if test="fullProcess.endDate != null and fullProcess.endDate != ''">
            <![CDATA[      and vdo.do_Apply_Date < to_date(#{fullProcess.endDate}, 'yyyy-mm-dd')   ]]>
        </if>
        <if test="fullProcess.doApplyDepartment != null and fullProcess.doApplyDepartment != ''">
            and vdo.do_Apply_Department LIKE '%' || #{fullProcess.doApplyDepartment} || '%'
        </if>
        <if test="fullProcess.companyName != null and fullProcess.companyName != ''">
            and vdo.company_Name LIKE '%' || #{fullProcess.companyName} || '%'
        </if>
        <if test="fullProcess.costCenterCode != null and fullProcess.costCenterCode != ''">
            and vdo.cost_Center_Code LIKE '%' || #{fullProcess.costCenterCode} || '%'
        </if>
        order by vdo.do_Id desc,vao.aoId desc,vpo.PURCHASE_ORDER_ID desc,vr.receive_goods_id desc,va.check_accept_id desc
    </sql>
    <select id="searchReceiveFullProcess" resultMap="fullProcessResultMap">
        <include refid="pagination_Head"/>
        <include refid="search_receive_full_process_fragment"/>
        <include refid="pagination_Tail"/>
        ORDER by do_Id desc,aoId desc,PURCHASE_ORDER_ID desc,receive_goods_id desc,check_accept_id desc
    </select>
    <select id="searchReceiveFullProcessCount" resultType="long">
        <include refid="count_Start_Head"/>
        <include refid="search_receive_full_process_fragment"/>
        <include refid="count_Start_Tail"/>
    </select>
    <select id="exportReceiveFullProcess" resultMap="fullProcessResultMap">
        <include refid="search_receive_full_process_fragment"/>
    </select>


    <sql id="search_payment_full_process_fragment">

    </sql>
    <select id="searchPaymentFullProcess" resultMap="fullProcessResultMap">
        <include refid="pagination_Head"/>
        <include refid="search_payment_full_process_fragment"/>
        <include refid="pagination_Tail"/>
    </select>
    <select id="searchPaymentFullProcessCount" resultType="long">
        <include refid="count_Start_Head"/>
        <include refid="search_payment_full_process_fragment"/>
        <include refid="count_Start_Tail"/>
    </select>
    <select id="exportPaymentFullProcess" resultMap="fullProcessResultMap">
        <include refid="search_payment_full_process_fragment"/>
    </select>



    <resultMap id="BaseResultMap" type="com.opple.fa.report.entity.FullProcessDetail" >
        <result column="DEMAND_ID" property="demandId" jdbcType="VARCHAR" />
        <result column="DEMAND_DETAIL_ID" property="demandDetailId"  />
        <result column="DO_APPLY_USER" property="doApplyUser" jdbcType="VARCHAR" />
        <result column="DO_APPLY_DATE" property="doApplyDate" jdbcType="TIMESTAMP" />
        <result column="BUDGET_DEPARTMENT_NAME" property="budgetDepartmentName" jdbcType="VARCHAR" />
        <result column="PROJECT_CODE" property="projectCode" jdbcType="VARCHAR" />
        <result column="PROJECT_NAME" property="projectName" jdbcType="VARCHAR" />
        <result column="ASSETS_NAME" property="assetsName" jdbcType="VARCHAR" />
        <result column="SPECIFICATION_PARAMETER" property="specificationParameter" jdbcType="VARCHAR" />
        <result column="FUNCTIONS" property="functions" jdbcType="VARCHAR" />
        <result column="UNITS" property="units" jdbcType="VARCHAR" />
        <result column="USE_DESCRIPTION" property="useDescription" jdbcType="VARCHAR" />
        <result column="ASSET_CLASSIFICATION" property="assetClassification" jdbcType="VARCHAR" />
        <result column="LEDGER_ACCOUNT" property="ledgerAccount" jdbcType="VARCHAR" />
        <result column="DEPRECIATION" property="depreciation"  />
        <result column="OFFICE_LOCATION" property="officeLocation" jdbcType="VARCHAR" />
        <result column="COMPANY_NAME" property="companyName" jdbcType="VARCHAR" />
        <result column="DEMAND_COUNT" property="demandCount"  />
        <result column="USED_SUM_MONEY" property="usedSumMoney"  />
        <result column="AVALIABLE_SUM_MONEY_OLD" property="avaliableSumMoneyOld"  />
        <result column="REFERENCE_PRICE" property="referencePrice"  />
        <result column="PROJECT_PROPOSAL" property="projectProposal" jdbcType="VARCHAR" />
        <result column="REQUIREMENTS_DATE" property="requirementsDate" jdbcType="TIMESTAMP" />
        <result column="COST_CENTER" property="costCenter" jdbcType="VARCHAR" />
        <result column="COST_CENTER_CODE" property="costCenterCode" jdbcType="VARCHAR" />
        <result column="ASSET_TYPE" property="assetType" jdbcType="VARCHAR" />
        <result column="WORK_SHOP_TYPE" property="workShopType" jdbcType="VARCHAR" />
        <result column="DEMAND_CAPPROVALSTATE" property="demandCapprovalstate" jdbcType="VARCHAR" />
        <result column="APPLY_ORDER_ID" property="applyOrderId" jdbcType="VARCHAR" />
        <result column="APPLY_DETAIL_ID" property="applyDetailId"  />
        <result column="AO_APPLY_USER" property="aoApplyUser" jdbcType="VARCHAR" />
        <result column="AO_APPLY_DATE" property="aoApplyDate" jdbcType="TIMESTAMP" />
        <result column="MAIN_ASSET_CODE" property="mainAssetCode" jdbcType="VARCHAR" />
        <result column="SECONDARY" property="secondary" jdbcType="VARCHAR" />
        <result column="APPLY_COUNT" property="applyCount"  />
        <result column="INQUIRY_UNIT_PRICE" property="inquiryUnitPrice"  />
        <result column="INQUIRY_PRICE" property="inquiryPrice"  />
        <result column="APPLY_CAPPROVALSTATE" property="applyCapprovalstate" jdbcType="VARCHAR" />
        <result column="PURCHASE_ID" property="purchaseId" jdbcType="VARCHAR" />
        <result column="PURCHASE_DETAIL_ID" property="purchaseDetailId"  />
        <result column="PURCHASE_ORDER_SAP_ID" property="purchaseOrderSapId" jdbcType="VARCHAR" />
        <result column="BUYER_NAME" property="buyerName" jdbcType="VARCHAR" />
        <result column="SUPPLIER_NAME" property="supplierName" jdbcType="VARCHAR" />
        <result column="PURCHASE_COUNT" property="purchaseCount"  />
        <result column="CURRENCY_CODE" property="currencyCode" jdbcType="VARCHAR" />
        <result column="EXCHANGE_RATE" property="exchangeRate"  />
        <result column="PURCHASE_UNIT_PRICE" property="purchaseUnitPrice"  />
        <result column="PURCHASE_PRICE" property="purchasePrice"  />
        <result column="PD_REQUIREMENTS_DATE" property="pdRequirementsDate" jdbcType="TIMESTAMP" />
        <result column="WARRANTY_PERIOD" property="warrantyPeriod"  />
        <result column="PURCHASE_CAPPROVALSTATE" property="purchaseCapprovalstate" jdbcType="VARCHAR" />
        <result column="RECEIVE_GOODS_ID" property="receiveGoodsId" jdbcType="VARCHAR" />
        <result column="RECEIVE_GOODS_DETAIL_ID" property="receiveGoodsDetailId" jdbcType="VARCHAR" />
        <result column="RECEIVE_DATE" property="receiveDate" jdbcType="TIMESTAMP" />
        <result column="RECEIVE_COUNT" property="receiveCount"  />
        <result column="CONTRACT_NO" property="contractNo" jdbcType="VARCHAR" />
        <result column="CHECK_ID" property="checkId" jdbcType="VARCHAR" />
        <result column="CA_CAPPROVALSTATE" property="caCapprovalstate" jdbcType="VARCHAR" />
        <result column="CHECK_COUNT" property="checkCount"  />
    </resultMap>

    <sql id="search_payment_full_process_detail_fragment" >
        SELECT DEMAND_ID, DEMAND_DETAIL_ID, DO_APPLY_USER,
        DO_APPLY_DATE, BUDGET_DEPARTMENT_NAME, PROJECT_CODE,
        PROJECT_NAME, ASSETS_NAME, SPECIFICATION_PARAMETER,
        FUNCTIONS, UNITS, USE_DESCRIPTION,
        ASSET_CLASSIFICATION, LEDGER_ACCOUNT, DEPRECIATION,
        OFFICE_LOCATION, COMPANY_NAME, DEMAND_COUNT,
        USED_SUM_MONEY, AVALIABLE_SUM_MONEY_OLD, REFERENCE_PRICE,
        PROJECT_PROPOSAL, REQUIREMENTS_DATE, COST_CENTER,COST_CENTER_CODE,
        ASSET_TYPE, WORK_SHOP_TYPE, DEMAND_CAPPROVALSTATE,
        APPLY_ORDER_ID, APPLY_DETAIL_ID, AO_APPLY_USER,
        AO_APPLY_DATE, MAIN_ASSET_CODE, SECONDARY,
        APPLY_COUNT, INQUIRY_UNIT_PRICE, INQUIRY_PRICE,
        APPLY_CAPPROVALSTATE, PURCHASE_ID, PURCHASE_DETAIL_ID,
        PURCHASE_ORDER_SAP_ID, BUYER_NAME, SUPPLIER_NAME,
        PURCHASE_COUNT, CURRENCY_CODE, EXCHANGE_RATE,
        PURCHASE_UNIT_PRICE, PURCHASE_PRICE, PD_REQUIREMENTS_DATE,
        WARRANTY_PERIOD, PURCHASE_CAPPROVALSTATE,RECEIVE_GOODS_ID,
        RECEIVE_GOODS_DETAIL_ID, RECEIVE_DATE, RECEIVE_COUNT,
        CONTRACT_NO, CHECK_ID, CA_CAPPROVALSTATE, CHECK_COUNT
        from V_FA_REPORT_FULLPROCESS_DETAIL
        where 1 = 1
        <if test="fullProcess.demandId != null and fullProcess.demandId != ''">
            and DEMAND_ID LIKE '%' || #{fullProcess.demandId} || '%'
        </if>
        <if test="fullProcess.applyOrderId != null and fullProcess.applyOrderId != ''">
            and APPLY_ORDER_ID LIKE '%' || #{fullProcess.applyOrderId} || '%'
        </if>
        <if test="fullProcess.purchaseId != null and fullProcess.purchaseId != ''">
            and PURCHASE_ID LIKE '%' || #{fullProcess.purchaseId} || '%'
        </if>
        <if test="fullProcess.purchaseOrderSapId != null and fullProcess.purchaseOrderSapId != ''">
            and PURCHASE_ORDER_SAP_ID LIKE '%' || #{fullProcess.purchaseOrderSapId} || '%'
        </if>
        <if test="fullProcess.receiveGoodsId != null and fullProcess.receiveGoodsId != ''">
            and receive_goods_id LIKE '%' || #{fullProcess.receiveGoodsId} || '%'
        </if>
        <if test="fullProcess.checkId != null and fullProcess.checkId != ''">
            and CHECK_ID LIKE '%' || #{fullProcess.checkId} || '%'
        </if>
        <if test="fullProcess.doApplyUser != null and fullProcess.doApplyUser != ''">
            and do_Apply_User LIKE '%' || #{fullProcess.doApplyUser} || '%'
        </if>
        <if test="fullProcess.startDate != null and fullProcess.startDate != ''">
            <![CDATA[      and do_Apply_Date >= to_date(#{fullProcess.startDate}, 'yyyy-mm-dd')  ]]>
        </if>
        <if test="fullProcess.endDate != null and fullProcess.endDate != ''">
            <![CDATA[      and do_Apply_Date < to_date(#{fullProcess.endDate}, 'yyyy-mm-dd')   ]]>
        </if>
        <if test="fullProcess.budgetDepartmentName != null and fullProcess.budgetDepartmentName != ''">
            and BUDGET_DEPARTMENT_NAME LIKE '%' || #{fullProcess.budgetDepartmentName} || '%'
        </if>

        <if test="fullProcess.costCenterCode != null and fullProcess.costCenterCode != ''">
            and COST_CENTER_CODE LIKE '%' || #{fullProcess.costCenterCode} || '%'
        </if>
        order by DEMAND_ID desc, DEMAND_DETAIL_ID desc,APPLY_ORDER_ID desc, APPLY_DETAIL_ID desc,
        PURCHASE_ID desc, PURCHASE_DETAIL_ID desc,RECEIVE_GOODS_ID desc,CHECK_ID desc
    </sql>


    <select id="searchReceiveFullProcessDetail" resultMap="BaseResultMap">
        <include refid="pagination_Head"/>
        <include refid="search_payment_full_process_detail_fragment"/>
        <include refid="pagination_Tail"/>
        order by DEMAND_ID desc, DEMAND_DETAIL_ID desc,APPLY_ORDER_ID desc, APPLY_DETAIL_ID desc,
        PURCHASE_ID desc, PURCHASE_DETAIL_ID desc,RECEIVE_GOODS_ID desc,CHECK_ID desc
    </select>
    <select id="searchReceiveFullProcessDetailCount" resultType="long">
        <include refid="count_Start_Head"/>
        <include refid="search_payment_full_process_detail_fragment"/>
        <include refid="count_Start_Tail"/>
    </select>
    <select id="exportReceiveFullProcessDetail" resultMap="BaseResultMap">
        <include refid="search_payment_full_process_detail_fragment"/>
    </select>


</mapper>