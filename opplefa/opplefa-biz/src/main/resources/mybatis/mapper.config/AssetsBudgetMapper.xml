<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.opple.fa.config.dao.AssetsBudgetDAO">
       <!-- oracle 分页头 -->
    <sql id="pagination_Head" >
        <![CDATA[select * from ( select row_.*, rownum rownum_ from ( ]]>
    </sql>
    <!-- oracle 分页尾 -->
    <sql id="pagination_Tail">
        <![CDATA[) row_ where rownum <= #{pager.pageSize}* #{pager.offset} ) where rownum_ >= #{pager.firstResult} + 1]]>
    </sql>
    <!-- count * from -->
	<sql id="count_Start_Head">
		<![CDATA[select count(*) from ( ]]>
	</sql>
	<sql id="count_Start_Tail">
		<![CDATA[) countObj ]]>
	</sql>
	<resultMap id="assetsBudgetResultMap" type="assetsBudget">
        <result property="id" column="ID"/>
        <result property="costCenter" column="COSE_CENTER"/>
        <result property="costCenterName" column="COSE_CENTER_NAME"/>
        <result property="company" column="COMPANY"/>
        <result property="companyName" column="COMPANY_NAME"/>
        <result property="projectCode" column="PROJECT_CODE"/>
        <result property="assetsModel" column="ASSETS_MODEL"/>
        <result property="assetsType" column="ASSETS_TYPE"/>
        <result property="assetsName" column="ASSETS_NAME"/>
        <result property="projectName" column="PROJECT_NAME"/>
        <result property="unit" column="UNIT"/>
        <result property="amount" column="AMOUNT"/>
        <result property="usedAmount" column="USED_AMOUNT"/>
        <result property="usedSumMoney" column="USED_SUM_MONEY"/>
        <result property="avaliableAmount" column="AVALIABLE_AMOUNT"/>
        <result property="avaliableSumMoney" column="AVALIABLE_SUM_MONEY"/>
        <result property="budgetYear" column="BUDGET_YEAR"/>
        <result property="isSure" column="IS_SURE"/>
        <result property="deleteFlag" column="DELETE_FLAG"/>
        <result property="version" column="VERSION"/>
        <result property="platform" column="PLATFORM"/>
        
        <result property="unitPrice" column="UNIT_PRICE"/>
        <result property="budgetBasedOn" column="BUDGET_BASED_ON"/>
        <result property="agoYearAllEstablishmentSum" column="AGO_YEAR_ALL_ESTABLISHMENT_SUM"/>
        <result property="agoYearAllContracts" column="AGO_YEAR_ALL_CONTRACTS"/>
        <result property="agoYearAllPay" column="AGO_YEAR_ALL_PAY"/>
        <result property="yearBudgetTotal" column="YEAR_BUDGET_TOTAL"/>
        <result property="assetsTypeCode" column="ASSETS_TYPE_CODE"/>
        <result property="createBy" column="CREATE_BY" />
        <result property="createByCode" column="CREATE_BY_CODE" />
		<result property="createDate" column="CREATE_DATE" />
		<result property="updateBy" column="UPDATE_BY" />
		<result property="updateByCode" column="UPDATE_BY_CODE" />
		<result property="updateDate" column="UPDATE_DATE" />
		<result property="checkMoney" column="CHECK_MONEY" />
	</resultMap>

	<sql id="search_assetsBudgets_fragment" >
        <![CDATA[
              SELECT
                    ID,
                    COSE_CENTER,
                    COSE_CENTER_NAME,
                    PROJECT_CODE,
                    ASSETS_MODEL,
                    ASSETS_TYPE,
                    ASSETS_NAME,
                    PROJECT_NAME,
                    UNIT,
                    AMOUNT,
                    USED_AMOUNT,
                    USED_SUM_MONEY,
                    AVALIABLE_AMOUNT,
                    AVALIABLE_SUM_MONEY,
                    UNIT_PRICE,
                    BUDGET_BASED_ON,
                    AGO_YEAR_ALL_ESTABLISHMENT_SUM,
                    AGO_YEAR_ALL_CONTRACTS ,
                    AGO_YEAR_ALL_PAY,
                    YEAR_BUDGET_TOTAL,
                    ASSETS_TYPE_CODE,
                    CREATE_BY,
                    CREATE_BY_CODE,
					CREATE_DATE,
					UPDATE_BY,
					UPDATE_BY_CODE,
		 			UPDATE_DATE,
		 			BUDGET_YEAR,
		 			IS_SURE,
		 			DELETE_FLAG,
		 			VERSION,
		 			PLATFORM,
		 			CHECK_MONEY
                FROM
                   TB_FA_ASSETS_BUDGET bb

        ]]>
    </sql>

    <select id="searchAssetsBudgets" resultMap="assetsBudgetResultMap">
        <include refid="pagination_Head" />
        <include refid="search_assetsBudgets_fragment" />
         WHERE 1=1		
		<if test="assetsBudget.project != null and assetsBudget.project != ''">
			AND PROJECT_NAME LIKE '%' || #{assetsBudget.project} || '%' OR PROJECT_CODE LIKE '%' || #{assetsBudget.project} || '%'
		</if>
		<if test="assetsBudget.budgetYear != null and assetsBudget.budgetYear != ''">
			AND BUDGET_YEAR LIKE '%' || #{assetsBudget.budgetYear} || '%' 
		</if>
		<if test="assetsBudget.platform != null and assetsBudget.platform != ''">
			AND PLATFORM LIKE '%' || #{assetsBudget.platform} || '%' 
		</if>
		<if
			test="assetsBudget.costCenterNameOrCode != null and assetsBudget.costCenterNameOrCode != ''">
			AND COSE_CENTER LIKE '%' || #{assetsBudget.costCenterNameOrCode} || '%' OR COSE_CENTER_NAME LIKE '%' || #{assetsBudget.costCenterNameOrCode} || '%'
		</if>
		<if test="assetsBudget.createBy != null and assetsBudget.createBy != ''">
			AND CREATE_BY LIKE '%' || #{assetsBudget.createBy} || '%' 
		</if>
		<if test="assetsBudget.fromDate != null and assetsBudget.fromDate != ''">
			<![CDATA[ AND CREATE_DATE >= #{assetsBudget.fromDate} ]]>
		</if>
		<if test="assetsBudget.toDate != null and assetsBudget.toDate != ''">
			<![CDATA[ AND CREATE_DATE <= #{assetsBudget.toDate} ]]>
	    </if>
	    <if test="assetsBudget.isSure != null and assetsBudget.isSure != ''">
			 AND IS_SURE = #{assetsBudget.isSure} 
	    </if>
	    AND (
	    EXISTS(SELECT 1 FROM t_Sys_Userrole TR WHERE TR.CROLECODE=#{assetsBudget.adminCode} 
						AND TR.CUSERCODE=#{assetsBudget.loginUserCode}  AND tr.cstatus='Y')
		 or (COSE_CENTER in ( select b.ccostcentercode
		  from t_sys_datapermission a
		 inner join tb_fa_depcostcenter b
		    on a.cbudgetdepcode = b.cdepcode
		 where a.cusercode=#{assetsBudget.loginUserCode}) AND IS_SURE = 'Y'	)
	    )
	    
	    and DELETE_FLAG = '0' order by PROJECT_CODE asc
        <include refid="pagination_Tail" />
    </select>
    
    <select id="searchAssetsBudgetsCount" resultType="long">
        <include refid="count_Start_Head" />
        <include refid="search_assetsBudgets_fragment" />
        WHERE 1=1			
		<if test="assetsBudget.project != null and assetsBudget.project != ''">
			AND PROJECT_NAME LIKE '%' || #{assetsBudget.project} || '%' OR PROJECT_CODE LIKE '%' || #{assetsBudget.project} || '%'
		</if>
		<if test="assetsBudget.budgetYear != null and assetsBudget.budgetYear != ''">
			AND BUDGET_YEAR LIKE '%' || #{assetsBudget.budgetYear} || '%' 
		</if>
		<if test="assetsBudget.platform != null and assetsBudget.platform != ''">
			AND PLATFORM LIKE '%' || #{assetsBudget.platform} || '%' 
		</if>
		<if
			test="assetsBudget.costCenterNameOrCode != null and assetsBudget.costCenterNameOrCode != ''">
			AND COSE_CENTER LIKE '%' || #{assetsBudget.costCenterNameOrCode} || '%' OR COSE_CENTER_NAME LIKE '%' || #{assetsBudget.costCenterNameOrCode} || '%'
		</if>
		<if test="assetsBudget.createBy != null and assetsBudget.createBy != ''">
			AND CREATE_BY LIKE '%' || #{assetsBudget.createBy} || '%' 
		</if>
        <if test="assetsBudget.fromDate != null and assetsBudget.fromDate != ''">
			<![CDATA[ AND CREATE_DATE >= #{assetsBudget.fromDate} ]]>
		</if>
		<if test="assetsBudget.toDate != null and assetsBudget.toDate != ''">
			<![CDATA[ AND CREATE_DATE <= #{assetsBudget.toDate} ]]>
	    </if>
	    <if test="assetsBudget.isSure != null and assetsBudget.isSure != ''">
			 AND IS_SURE = #{assetsBudget.isSure} 
	    </if>
		AND (
		    EXISTS(SELECT 1 FROM t_Sys_Userrole TR WHERE TR.CROLECODE=#{assetsBudget.adminCode} 
							AND TR.CUSERCODE=#{assetsBudget.loginUserCode}  AND tr.cstatus='Y')
			 or (COSE_CENTER in ( select b.ccostcentercode
			  from t_sys_datapermission a
			 inner join tb_fa_depcostcenter b
			    on a.cbudgetdepcode = b.cdepcode
			 where a.cusercode=#{assetsBudget.loginUserCode}) AND IS_SURE = 'Y'	)
	    )
	    and DELETE_FLAG = '0' order by PROJECT_CODE asc
	    <include refid="count_Start_Tail" />
    </select>
    
	<select id="exportAssetsBudget" resultMap="assetsBudgetResultMap">
        <include refid="search_assetsBudgets_fragment" />
         WHERE 1=1
         <if test="assetsBudget.project != null and assetsBudget.project != ''">
			AND PROJECT_NAME LIKE '%' || #{assetsBudget.project} || '%' OR PROJECT_CODE LIKE '%' || #{assetsBudget.project} || '%'
		</if>
		<if test="assetsBudget.budgetYear != null and assetsBudget.budgetYear != ''">
			AND BUDGET_YEAR LIKE '%' || #{assetsBudget.budgetYear} || '%' 
		</if>
		<if test="assetsBudget.platform != null and assetsBudget.platform != ''">
			AND PLATFORM LIKE '%' || #{assetsBudget.platform} || '%' 
		</if>
		<if
			test="assetsBudget.costCenterNameOrCode != null and assetsBudget.costCenterNameOrCode != ''">
			AND COSE_CENTER LIKE '%' || #{assetsBudget.costCenterNameOrCode} || '%' OR COSE_CENTER_NAME LIKE '%' || #{assetsBudget.costCenterNameOrCode} || '%'
		</if>
		<if test="assetsBudget.createBy != null and assetsBudget.createBy != ''">
			AND CREATE_BY LIKE '%' || #{assetsBudget.createBy} || '%' 
		</if>
        <if test="assetsBudget.fromDate != null and assetsBudget.fromDate != ''">
			<![CDATA[ AND CREATE_DATE >= #{assetsBudget.fromDate} ]]>
		</if>
		<if test="assetsBudget.toDate != null and assetsBudget.toDate != ''">
			<![CDATA[ AND CREATE_DATE <= #{assetsBudget.toDate} ]]>
	    </if>
	    <if test="assetsBudget.isSure != null and assetsBudget.isSure != ''">
			 AND IS_SURE = #{assetsBudget.isSure} 
	    </if>
	    AND (
		    EXISTS(SELECT 1 FROM t_Sys_Userrole TR WHERE TR.CROLECODE=#{assetsBudget.adminCode} 
							AND TR.CUSERCODE=#{assetsBudget.loginUserCode}  AND tr.cstatus='Y')
			 or (COSE_CENTER in ( select b.ccostcentercode
			  from t_sys_datapermission a
			 inner join tb_fa_depcostcenter b
			    on a.cbudgetdepcode = b.cdepcode
			 where a.cusercode=#{assetsBudget.loginUserCode}) AND IS_SURE = 'Y'	)
	    )
		AND DELETE_FLAG = '0' order by PROJECT_CODE asc
    </select>
	<select id="searchAssetsBudgetsByProjectCode" resultMap="assetsBudgetResultMap">
        <include refid="search_assetsBudgets_fragment" />
         WHERE PROJECT_CODE = #{assetsBudget.projectCode} and DELETE_FLAG = '0'
    </select>

    <select id="searchAssetsBudgetsList" resultMap="assetsBudgetResultMap">
        <include refid="search_assetsBudgets_fragment" />
         WHERE 1=1
         <if
			test="assetsBudget.projectName != null and assetsBudget.projectName != ''">
			AND (PROJECT_NAME LIKE '%' || #{assetsBudget.projectName} || '%' OR PROJECT_CODE LIKE '%' || #{assetsBudget.projectName} || '%' )
		</if>
		<if
			test="assetsBudget.assetsType != null and assetsBudget.assetsType != ''">
			<!-- AND ASSETS_TYPE LIKE '%' || #{assetsBudget.assetsType} || '%'  -->
		</if>
		<if
			test="assetsBudget.costCenter != null and assetsBudget.costCenter != ''">
			AND COSE_CENTER LIKE '%' || #{assetsBudget.costCenter} || '%' 
		</if>
		and DELETE_FLAG = '0'
		AND BUDGET_YEAR = #{assetsBudget.budgetYear}
		and year_budget_total != 0
		<![CDATA[AND Avaliable_Sum_Money > 0 ]]>
		AND IS_SURE = 'Y'
		AND DELETE_FLAG = '0'
    </select>
    <update id="writeBack">
		  UPDATE TB_FA_ASSETS_BUDGET  
          SET 
          USED_AMOUNT = USED_AMOUNT+#{usedAmount},      
          USED_SUM_MONEY = USED_SUM_MONEY+#{usedSumMoney},      
          AVALIABLE_AMOUNT = AVALIABLE_AMOUNT-#{usedAmount},    
          AVALIABLE_SUM_MONEY = AVALIABLE_SUM_MONEY-#{usedSumMoney}     
          WHERE PROJECT_CODE = #{projectCode}   
          AND BUDGET_YEAR = #{budgetYear}
	</update>
	
	<insert id="insertAssetsBudgets" parameterType="assetsBudget">
	  	 INSERT INTO TB_FA_ASSETS_BUDGET (
  	 	 		ID,
                COSE_CENTER,
                COSE_CENTER_NAME,
                PROJECT_CODE,
                ASSETS_MODEL,
                ASSETS_TYPE,
                ASSETS_NAME,
                PROJECT_NAME,
                UNIT,
                AMOUNT,
                USED_AMOUNT,
                USED_SUM_MONEY,
                AVALIABLE_AMOUNT,
                AVALIABLE_SUM_MONEY,
                UNIT_PRICE,
                BUDGET_BASED_ON,
                AGO_YEAR_ALL_ESTABLISHMENT_SUM,
                AGO_YEAR_ALL_CONTRACTS ,
                AGO_YEAR_ALL_PAY,
                YEAR_BUDGET_TOTAL,
                ASSETS_TYPE_CODE,
                CREATE_BY,
                CREATE_BY_CODE,
				CREATE_DATE,
				UPDATE_BY,
				UPDATE_BY_CODE,
	 			UPDATE_DATE,
	 			BUDGET_YEAR,
	 			IS_SURE,
	 			DELETE_FLAG,
	 			VERSION,
	 			PLATFORM
		   )
		   values
	        	(
	        seq_fa_assets_budget_id.nextval,
        	#{assetsBudget.costCenter} ,
        	#{assetsBudget.costCenterName} ,
        	#{assetsBudget.projectCode} ,
        	#{assetsBudget.assetsModel} ,
        	#{assetsBudget.assetsType} ,
        	#{assetsBudget.assetsName} ,
        	#{assetsBudget.projectName} ,
        	#{assetsBudget.unit} ,
        	#{assetsBudget.amount} ,
        	#{assetsBudget.usedAmount} ,
        	#{assetsBudget.usedSumMoney} ,
        	#{assetsBudget.avaliableAmount} ,
        	#{assetsBudget.avaliableSumMoney} ,
        	#{assetsBudget.unitPrice} ,
        	#{assetsBudget.budgetBasedOn} ,
        	#{assetsBudget.agoYearAllEstablishmentSum} ,
        	#{assetsBudget.agoYearAllContracts} ,
        	#{assetsBudget.agoYearAllPay} ,
        	#{assetsBudget.yearBudgetTotal} ,
        	#{assetsBudget.assetsTypeCode} ,
        	#{assetsBudget.createBy} ,
        	#{assetsBudget.createByCode} ,
        	#{assetsBudget.createDate} ,
        	#{assetsBudget.updateBy} ,
        	#{assetsBudget.updateByCode} ,
        	#{assetsBudget.updateDate} ,
        	#{assetsBudget.budgetYear} ,
        	'N',
        	'0',
        	#{assetsBudget.version},
        	#{assetsBudget.platform}
	        	)
  	</insert>
  	<update id="updateAssetsBudgets"  parameterType="assetsBudget">
		update TB_FA_ASSETS_BUDGET set
		COSE_CENTER=#{assetsBudget.costCenter},
		COSE_CENTER_NAME=#{assetsBudget.costCenterName} ,
		ASSETS_MODEL=#{assetsBudget.assetsModel},
		ASSETS_TYPE=#{assetsBudget.assetsType} ,
		ASSETS_NAME=#{assetsBudget.assetsName} ,
		PROJECT_NAME=#{assetsBudget.projectName} ,
		UNIT=#{assetsBudget.unit} ,
		USED_AMOUNT=#{assetsBudget.usedAmount},
		USED_SUM_MONEY=#{assetsBudget.usedSumMoney},
		AVALIABLE_AMOUNT=#{assetsBudget.avaliableAmount} ,
		AVALIABLE_SUM_MONEY=#{assetsBudget.avaliableSumMoney} ,
		BUDGET_BASED_ON=#{assetsBudget.budgetBasedOn} ,
		YEAR_BUDGET_TOTAL=#{assetsBudget.yearBudgetTotal},
		AMOUNT=#{assetsBudget.amount},
		UNIT_PRICE=#{assetsBudget.unitPrice},
		VERSION=#{assetsBudget.version},
		IS_SURE='N'
		where PROJECT_CODE=#{assetsBudget.projectCode} AND BUDGET_YEAR=#{assetsBudget.budgetYear}
	</update>
	<update id="confirmBudget"  parameterType="assetsBudget">
		update TB_FA_ASSETS_BUDGET set
		IS_SURE='Y'
		where ID=#{assetsBudget.id} 
	</update>
	<update id="concelConfirmBudget"  parameterType="assetsBudget">
		update TB_FA_ASSETS_BUDGET set
		IS_SURE='N'
		where ID=#{assetsBudget.id}
	</update>
	<update id="deleteBudget"  parameterType="assetsBudget">
		update TB_FA_ASSETS_BUDGET set
		DELETE_FLAG='1'
		where ID=#{assetsBudget.id}
	</update>
	<select id="getAssetsBudgetsbyProjectCode" resultType="long" parameterType="assetsBudget">
		select count(*) from TB_FA_ASSETS_BUDGET WHERE 
	PROJECT_CODE=#{assetsBudget.projectCode}	and DELETE_FLAG = '0'
	</select>
	<select id="getAssetsBudgetbyProjectCodeAndYear" resultMap="assetsBudgetResultMap" >
		<include refid="search_assetsBudgets_fragment" />
		WHERE 1 = 1
			AND PROJECT_CODE=#{projectCode}
			AND BUDGET_YEAR=#{year}
	</select>
	<select id="getAssetsBudget" resultMap="assetsBudgetResultMap" parameterType="assetsBudget">
		select * from TB_FA_ASSETS_BUDGET WHERE 
	    ID = #{assetsBudget.id} 
	</select>
	<select id="getAssetsBudgetsbyProjectCodeAndYear" resultType="long" parameterType="assetsBudget">
		select count(*) from TB_FA_ASSETS_BUDGET WHERE 
	PROJECT_CODE=#{assetsBudget.projectCode} AND BUDGET_YEAR=#{assetsBudget.budgetYear} and DELETE_FLAG = '0'
	</select>
	<update id="confirmAllBudget" >
        update TB_FA_ASSETS_BUDGET set
		IS_SURE='Y'
    </update>
	<update id="updateVersion" parameterType="assetsBudget">
        update TB_FA_ASSETS_BUDGET set
		VERSION=#{assetsBudget.version}
    </update>
	<resultMap id="budgetDetailResultMap" type="com.opple.fa.config.entity.BudgetAdjustmentDetail">
		<result property="budgetYear" column="BUDGET_YEAR"/>
		<result property="costCenter" column="COSE_CENTER"/>
		<result property="costCenterName" column="COSE_CENTER_NAME"/>
		<result property="platform" column="PLATFORM"/>
		<result property="projectCode" column="PROJECT_CODE"/>
		<result property="projectName" column="PROJECT_NAME"/>
		<result property="assetsName" column="ASSETS_NAME"/>
		<result property="assetsType" column="ASSETS_TYPE"/>
		<result property="assetsModel" column="ASSETS_MODEL"/>
		<result property="unit" column="UNIT"/>
		<result property="beforeAdjustCount" column="AMOUNT"/>
		<result property="beforeUnitPrice" column="UNIT_PRICE"/>
		<result property="usedAmount" column="USED_AMOUNT"/>
		<result property="usedSumMoney" column="USED_SUM_MONEY"/>
		<result property="beforeAdjustMoney" column="YEAR_BUDGET_TOTAL"/>
	</resultMap>
	<select id="getBudgetDetailsbyProjectCodeAndYear" resultMap="budgetDetailResultMap" >
		<include refid="search_assetsBudgets_fragment" />
		WHERE 1 = 1
			AND PROJECT_CODE=#{projectCode}
			AND BUDGET_YEAR=#{year}
	</select>

	<!--调整审批结束时更新预算表-->
	<update id="updateAssetsBudgetAfterApprove">
		UPDATE TB_FA_ASSETS_BUDGET SET
			YEAR_BUDGET_TOTAL=#{budgetAdjustmentDetail.afterAdjustMoney},
			AVALIABLE_SUM_MONEY=#{budgetAdjustmentDetail.useableMoney},
			AMOUNT=#{budgetAdjustmentDetail.afterAdjustCount},
			AVALIABLE_AMOUNT=#{budgetAdjustmentDetail.useableCount},
			UNIT_PRICE=#{budgetAdjustmentDetail.afterUnitPrice},
			IS_SURE = 'Y'
		  WHERE PROJECT_CODE=#{budgetAdjustmentDetail.projectCode}
		  		AND BUDGET_YEAR=#{budgetAdjustmentDetail.budgetYear}
	</update>
	<insert id="addAssetsBudgetAfterApprove">
		INSERT INTO TB_FA_ASSETS_BUDGET (
  	 	 		ID,
                COSE_CENTER,
                COSE_CENTER_NAME,
                PLATFORM,
                PROJECT_CODE,
                ASSETS_MODEL,
                ASSETS_TYPE,
                ASSETS_NAME,
                PROJECT_NAME,
                UNIT,
                AMOUNT,
                USED_AMOUNT,
                USED_SUM_MONEY,
                AVALIABLE_AMOUNT,
                AVALIABLE_SUM_MONEY,
                UNIT_PRICE,
                BUDGET_BASED_ON,
                YEAR_BUDGET_TOTAL,
                CREATE_BY,
                CREATE_BY_CODE,
				CREATE_DATE,
				UPDATE_BY,
				UPDATE_BY_CODE,
	 			UPDATE_DATE,
	 			BUDGET_YEAR,
	 			IS_SURE,
	 			DELETE_FLAG
		   )
		   values
	        	(
	        seq_fa_assets_budget_id.nextval,
        	#{budgetAdjustmentDetail.costCenter} ,
        	#{budgetAdjustmentDetail.costCenterName} ,
        	#{budgetAdjustmentDetail.platform} ,
        	#{budgetAdjustmentDetail.projectCode} ,
        	#{budgetAdjustmentDetail.assetsModel} ,
        	#{budgetAdjustmentDetail.assetsType} ,
        	#{budgetAdjustmentDetail.assetsName} ,
        	#{budgetAdjustmentDetail.projectName} ,
        	#{budgetAdjustmentDetail.unit} ,
        	#{budgetAdjustmentDetail.beforeAdjustCount} ,
        	#{budgetAdjustmentDetail.usedAmount} ,
        	#{budgetAdjustmentDetail.usedSumMoney} ,
        	#{budgetAdjustmentDetail.useableCount} ,
        	#{budgetAdjustmentDetail.useableMoney} ,
        	#{budgetAdjustmentDetail.beforeUnitPrice} ,
        	#{budgetAdjustmentDetail.budgetBasedOn} ,
        	#{budgetAdjustmentDetail.beforeAdjustMoney} ,
        	#{budgetAdjustmentDetail.createUserName} ,
        	#{budgetAdjustmentDetail.createBy} ,
        	#{budgetAdjustmentDetail.createDate} ,
        	#{budgetAdjustmentDetail.updateUserName} ,
        	#{budgetAdjustmentDetail.updateBy} ,
        	#{budgetAdjustmentDetail.updateDate} ,
        	#{budgetAdjustmentDetail.budgetYear} ,
		'Y',
        	'0'
	        	)
	</insert>
	<delete id="deleteAssetsBudgetAfterDrop">
		DELETE FROM TB_FA_ASSETS_BUDGET
			WHERE PROJECT_CODE=#{budgetAdjustmentDetail.projectCode}
				  AND BUDGET_YEAR=#{budgetAdjustmentDetail.budgetYear}
	</delete>


	<insert id="saveDataToHistory">
		insert INTO TB_FA_ASSETS_BUDGET_HISTORY
		  (COSE_CENTER,
		   PROJECT_CODE,
		   ASSETS_MODEL,
		   ASSETS_TYPE,
		   ASSETS_NAME,
		   PROJECT_NAME,
		   UNIT,
		   AMOUNT,
		   UNIT_PRICE,
		   BUDGET_BASED_ON,
		   AGO_YEAR_ALL_ESTABLISHMENT_SUM,
		   AGO_YEAR_ALL_CONTRACTS,
		   AGO_YEAR_ALL_PAY,
		   YEAR_BUDGET_TOTAL,
		   CREATE_BY,
		   CREATE_DATE,
		   UPDATE_BY,
		   UPDATE_DATE,
		   ASSETS_TYPE_CODE,
		   USED_AMOUNT,
		   USED_SUM_MONEY,
		   AVALIABLE_AMOUNT,
		   AVALIABLE_SUM_MONEY,
		   COSE_CENTER_NAME,
		   COMPANY,
		   COMPANY_NAME,
		   CREATE_BY_CODE,
		   UPDATE_BY_CODE,
		   BUDGET_YEAR,
		   IS_SURE,
		   DELETE_FLAG,
		   VERSION,
		   PLATFORM,
		   CHECK_MONEY)
		  SELECT COSE_CENTER,
				 PROJECT_CODE,
				 ASSETS_MODEL,
				 ASSETS_TYPE,
				 ASSETS_NAME,
				 PROJECT_NAME,
				 UNIT,
				 AMOUNT,
				 UNIT_PRICE,
				 BUDGET_BASED_ON,
				 AGO_YEAR_ALL_ESTABLISHMENT_SUM,
				 AGO_YEAR_ALL_CONTRACTS,
				 AGO_YEAR_ALL_PAY,
				 YEAR_BUDGET_TOTAL,
				 CREATE_BY,
				 SYSDATE                        AS CREATE_DATE,
				 UPDATE_BY,
				 SYSDATE                        AS UPDATE_DATE,
				 ASSETS_TYPE_CODE,
				 USED_AMOUNT,
				 USED_SUM_MONEY,
				 AVALIABLE_AMOUNT,
				 AVALIABLE_SUM_MONEY,
				 COSE_CENTER_NAME,
				 COMPANY,
				 COMPANY_NAME,
				 CREATE_BY_CODE,
				 UPDATE_BY_CODE,
				 BUDGET_YEAR,
				 IS_SURE,
				 DELETE_FLAG,
				 VERSION,
				 PLATFORM,
				 CHECK_MONEY
			FROM TB_FA_ASSETS_BUDGET
	</insert>
</mapper>

