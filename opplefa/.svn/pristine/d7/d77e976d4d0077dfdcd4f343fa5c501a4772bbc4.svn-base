<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.opple.fa.discardsell.dao.DiscardSellDetailDAO">

    <!-- oracle 分页头 -->
    <sql id="pagination_Head" >
        <![CDATA[select * from ( select row_.*, rownum rownum_ from ( ]]>
    </sql>
    <!-- oracle 分页尾 -->
    <sql id="pagination_Tail">
        <![CDATA[) row_ where rownum <= #{pager.pageSize}* #{pager.offset} ) where rownum_ >= #{pager.firstResult} + 1]]>
    </sql>
    <!-- count * from -->
	<sql id="count_Start_Head">
		<![CDATA[select count(*) from ( ]]>
	</sql>
	<sql id="count_Start_Tail">
		<![CDATA[) countObj ]]>
	</sql>
	<resultMap id="discardSellDetailMap" type="com.opple.fa.discardsell.entity.DiscardSellDetail">
        <result property="id" column="ID"/>
		<result property="createBy" column="CREATE_BY"/>
		<result property="createDate" column="CREATE_DATE"/>
		<result property="updateBy" column="UPDATE_BY"/>
		<result property="updateDate" column="UPDATE_DATE"/>
		<result property="deletedFlag" column="DELETED_FLAG"/>
		<result property="generalAssetId" column="GENERAL_ASSET_ID"/>
		<result property="discardSellId" column="DISCARD_SELL_ID"/>
		<result property="discardPercent" column="DISCARD_PERCENT"/>
		<result property="discardMoney" column="DISCARD_MONEY"/>
		<result property="scrapCertificate" column="SCRAP_CERTIFICATE"/>
		<result property="assetOriginalValue" column="ASSET_ORIGINAL_VALUE"/>
		<result property="assetNetValue" column="ASSET_NET_VALUE"/>
		<result property="companyName" column="COMPANY_NAME"/>
		<result property="companyCode" column="COMPANY_CODE"/>
		<result property="costCenterCode" column="COST_CENTER_CODE"/>
		<result property="costCenterName" column="COST_CENTER_NAME"/>
		<result property="assetCode" column="ASSET_CODE"/>
		<result property="assetName" column="ASSET_NAME"/>
		<result property="assetPerson" column="ASSET_PERSON"/>
		<result property="assetPersonCode" column="ASSET_PERSON_CODE"/>
		<result property="location" column="LOCATION"/>
		<result property="assetType" column="ASSET_TYPE"/>
		<result property="depStartDate" column="depStartDate"/>
		
	</resultMap>
	<insert id="insertDiscardSellDetail" parameterType="com.opple.fa.discardsell.entity.DiscardSellDetail">
		insert into TB_FA_DISCARD_SELL_DETAIL
			(ID,
			CREATE_BY,
			CREATE_DATE,
			UPDATE_BY,
			UPDATE_DATE,
			DELETED_FLAG,
			GENERAL_ASSET_ID,
			DISCARD_SELL_ID,
			DISCARD_PERCENT,
			DISCARD_MONEY,
			ASSET_ORIGINAL_VALUE,
			ASSET_NET_VALUE,
			COMPANY_NAME,
			COMPANY_CODE,
			COST_CENTER_CODE,
			COST_CENTER_NAME,
			ASSET_CODE,
			ASSET_NAME,
			ASSET_PERSON,
			ASSET_PERSON_CODE,
			LOCATION,
			ASSET_TYPE

			)
			values
			(seq_discard_sell_detail.nextval,
			#{createBy},
			#{createDate},
			#{updateBy},
			#{updateDate},
			0,
			#{generalAssetId},
			#{discardSellId},
			#{discardPercent},
			#{discardMoney},
			#{assetOriginalValue},
			#{assetNetValue},
			#{companyName},
			#{companyCode},
			#{costCenterCode},
			#{costCenterName},
			#{assetCode},
			#{assetName},
			#{assetPerson},
			#{assetPersonCode},
			#{location},
			#{assetType}	
			)
	</insert>
	<select id="serachDiscardSellDetail" resultMap="discardSellDetailMap">
		select d.ID,
		d.CREATE_BY,
		d.CREATE_DATE,
		d.UPDATE_BY,
		d.UPDATE_DATE,
		d.GENERAL_ASSET_ID,
		d.DISCARD_SELL_ID,
		d.DISCARD_PERCENT,
		d.DISCARD_MONEY,
		d.SCRAP_CERTIFICATE,
		d.ASSET_ORIGINAL_VALUE,
		d.ASSET_NET_VALUE,
		d.COMPANY_NAME,
		d.COMPANY_CODE,
		d.COST_CENTER_CODE,
		d.COST_CENTER_NAME,
		d.ASSET_CODE,
		d.ASSET_NAME,
		d.ASSET_PERSON,
		d.ASSET_PERSON_CODE,
		d.LOCATION,
		d.ASSET_TYPE,
		t.DEPRECIATION_START_DATE as depStartDate
		from TB_FA_DISCARD_SELL_DETAIL d
		Left Join tb_fa_general_asset t 
		on t.id=d.GENERAL_ASSET_ID
		where d.DELETED_FLAG=0 AND d.DISCARD_SELL_ID=#{id}
	</select>
	<update id="deleteDiscardSellDetail" parameterType="com.opple.fa.discardsell.entity.DiscardSellDetail">
			update TB_FA_DISCARD_SELL_DETAIL set DELETED_FLAG=1 where DISCARD_SELL_ID=#{discardSellId}
 	</update>
 	<select id="serachDiscardSellDetailByAssetId" parameterType="com.opple.fa.discardsell.entity.DiscardSellDetail" resultMap="discardSellDetailMap">
 		select * from  TB_FA_DISCARD_SELL_DETAIL where DELETED_FLAG=0 and GENERAL_ASSET_ID=#{discardSellDetail.generalAssetId} order by ID desc
 	</select>
 	<select id="getDiscardSellDetailByAssetId" parameterType="com.opple.fa.discardsell.entity.DiscardSellDetail" resultMap="discardSellDetailMap">
 		select ID,
		CREATE_BY,
		CREATE_DATE,
		UPDATE_BY,
		UPDATE_DATE,
		GENERAL_ASSET_ID,
		DISCARD_SELL_ID,
		DISCARD_PERCENT,
		DISCARD_MONEY,
		SCRAP_CERTIFICATE,
		ASSET_ORIGINAL_VALUE,
		ASSET_NET_VALUE,
		COMPANY_NAME,
		COMPANY_CODE,
		COST_CENTER_CODE,
		COST_CENTER_NAME,
		ASSET_CODE,
		ASSET_NAME,
		ASSET_PERSON,
		ASSET_PERSON_CODE,
		LOCATION,
		ASSET_TYPE
		from TB_FA_DISCARD_SELL_DETAIL
		WHERE GENERAL_ASSET_ID=#{generalAssetId} and DISCARD_SELL_ID=#{discardSellId} and DELETED_FLAG=0
 	</select>
 	<select id="serachDiscardSellDetailBydiscardSellId" parameterType="com.opple.fa.discardsell.entity.DiscardSellDetail" resultMap="discardSellDetailMap">
 		select * from  TB_FA_DISCARD_SELL_DETAIL where DELETED_FLAG=0 and DISCARD_SELL_ID=#{discardSellDetail.discardSellId}
 	</select>
 	<update id="updateScrapCertificate" parameterType="com.opple.fa.discardsell.entity.DiscardSellDetail">
 		update TB_FA_DISCARD_SELL_DETAIL
 		set
 		SCRAP_CERTIFICATE=#{scrapCertificate}
 		where ID=#{id}
 	</update>
 	<select id="serachGeneralIds" resultType="String" parameterType="com.opple.fa.discardsell.entity.DiscardSellDetail">
 		select GENERAL_ASSET_ID from TB_FA_DISCARD_SELL_DETAIL where  DISCARD_SELL_ID=#{discardSellId} and DELETED_FLAG=0
 	</select>
</mapper>

