<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.opple.fa.config.dao.PurchaseOrderFileDAO">
    <!-- oracle 分页头 -->
    <sql id="pagination_Head" >
        <![CDATA[select * from ( select row_.*, rownum rownum_ from ( ]]>
    </sql>
    <!-- oracle 分页尾 -->
    <sql id="pagination_Tail">
        <![CDATA[) row_ where rownum <= #{pager.pageSize}* #{pager.offset} ) where rownum_ >= #{pager.firstResult} + 1]]>
    </sql>
    <!-- count * from -->
	<sql id="count_Start_Head">
		<![CDATA[select count(*) from ( ]]>
	</sql>
	<sql id="count_Start_Tail">
		<![CDATA[) countObj ]]>
	</sql>
	<resultMap id="purchaseOrderFileResultMap" type="purchaseOrderFile">
        <result property="id" column="IID"/>
        <result property="document" column="CDOCUMENT"/>
        <result property="fileUId" column="CFILE_UID"/>
        <result property="fileType" column="CFILE_TYPE"/>
        <result property="fileName" column="CFILE_NAME"/>
        <result property="flag" column="CFLAG"/>
        <result property="createBy" column="CCREATE_BY" />
         <result property="createByCode" column="CCREATE_BY_CODE" />
		<result property="createDate" column="DREATE_DATE" />
		<result property="updateBy" column="CUPDATE_BY" />
		<result property="updateByCode" column="CUPDATE_BY_CODE" />
		<result property="updateDate" column="DPDATE_DATE" />
	</resultMap>

	<sql id="search_purchaseOrderFiles_fragment" >
        <![CDATA[
              SELECT
                    bb.IID,
                    bb.CDOCUMENT,
                    bb.CFILE_UID,
                    bb.CFILE_TYPE,
                    bb.CFILE_NAME,
                    bb.CFLAG,
                    bb.CCREATE_BY,
                    bb.CCREATE_BY_CODE,
					bb.DCREATE_DATE,
					bb.CUPDATE_BY,
					bb.CUPDATE_BY_CODE,
		 			bb.DUPDATE_DATE
                FROM
                   TB_FA_PURCHASE_ORDER_FILE bb

        ]]>
    </sql>
    
      <insert id="save" parameterType="purchaseOrderFile" >
    	 <selectKey resultType="java.lang.Long" order="AFTER" keyProperty="IID">
            SELECT SEQ_FA_PURCHASE_ORDER_FILE.currval AS IID FROM DUAL  
        </selectKey>
        insert into TB_FA_PURCHASE_ORDER_FILE 
          ( IID,
          	CDOCUMENT,
        	CFILE_UID,
            CFILE_TYPE,
            CFILE_NAME,
            CFLAG,
            CCREATE_BY,
            CCREATE_BY_CODE,
            CUPDATE_BY,
            CUPDATE_BY_CODE,
            DUPDATE_DATE)   
         values
          ( SEQ_FA_PURCHASE_ORDER_FILE.NEXTVAL,
          	#{purchaseOrderFile.document},   
            #{purchaseOrderFile.fileUId}, 
            #{purchaseOrderFile.fileType},   
            #{purchaseOrderFile.fileName},  
            #{purchaseOrderFile.flag},   
            #{purchaseOrderFile.createBy},   
            #{purchaseOrderFile.createByCode},   
            #{purchaseOrderFile.updateBy},
            #{purchaseOrderFile.updateByCode},    
            #{purchaseOrderFile.updateDate})
    </insert>
    

    <select id="searchPurchaseOrderFiles" resultMap="purchaseOrderFileResultMap">
        <include refid="pagination_Head" />
        <include refid="search_purchaseOrderFiles_fragment" />
         WHERE 1=1
		<if 
			test="purchaseOrderFile.document != null and purchaseOrderFile.document != ''">
			AND bb.CDOCUMENT = #{purchaseOrderFile.document} 
		</if>
        <include refid="pagination_Tail" />
    </select>

    <select id="searchPurchaseOrderFilesCount" resultType="long">
        <include refid="count_Start_Head" />
        <include refid="search_purchaseOrderFiles_fragment" />
        WHERE 1=1
		<if 
			test="purchaseOrderFile.document != null and purchaseOrderFile.document != ''">
			AND bb.CDOCUMENT = #{purchaseOrderFile.document} 
		</if>
        <include refid="count_Start_Tail" />
    </select>


    <select id="searchPurchaseOrderFilesList" resultMap="purchaseOrderFileResultMap">
        <include refid="search_purchaseOrderFiles_fragment" />
         WHERE 1=1
        <if 
			test="purchaseOrderFile.document != null and purchaseOrderFile.document != ''">
			AND bb.CDOCUMENT = #{purchaseOrderFile.document} 
		</if>
        <if 
			test="purchaseOrderFile.flag != null and purchaseOrderFile.flag != ''">
			AND bb.CFLAG = #{purchaseOrderFile.flag} 
		</if>
	
    </select>
    <delete id="deleteByIds"  parameterType="string" >
    DELETE FROM TB_FA_PURCHASE_ORDER_FILE WHERE IID IN ( ${_parameter})
    </delete>
</mapper>

