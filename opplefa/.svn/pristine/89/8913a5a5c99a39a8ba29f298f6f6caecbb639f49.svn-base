<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.opple.fa.config.dao.WorkAddressDAO">

	<resultMap id="workAddressResultMap" type="workAddress">
		<result property="caddressCode" column="CADDRESS_CODE" />		<!--办公地点编码 -->
		<result property="caddressName" column="CADDRESS_NAME" />		<!--办公地点 -->
		<result property="ccreateBy" column="CCREATE_BY" />		<!--创建人 -->
		<result property="dcreateDate" column="DCREATE_DATE" />		<!--创建时间 -->
		<result property="cupdateBy" column="CUPDATE_BY" />		<!--更新人 -->
		<result property="dupdateDate" column="DUPDATE_DATE" />		<!--更新时间 -->
		<result property="ccreateByCode" column="CCREATE_BY_CODE" />		<!--创建人编码 -->
		<result property="cupdateByCode" column="CUPDATE_BY_CODE" />		<!--最后更新人编码 -->
		<result property="cmemo" column="CMEMO" />		<!--备注 -->
		<result property="cstatus" column="CSTATUS" />		<!--数据状态, -->
		<result property="receivegoodsName" column="RECEIVEGOODS_NAME" />			<!--仓库收货管理员姓名 -->
		<result property="receivegoodsCode" column="RECEIVEGOODS_CODE" />			<!--仓库收货管理员编码 -->
		<result property="retiredgoodsName" column="RETIREDGOODS_NAME" />			<!--仓库废品管理员姓名 -->
		<result property="retiredgoodsCode" column="RETIREDGOODS_CODE" />			<!--仓库废品管理员编码 -->
		<result property="purchasetipaccessName" column="PURCHASETIPACCESS_NAME" />			<!--采购意见处理员姓名 -->
		<result property="purchasetipaccessCode" column="PURCHASETIPACCESS_CODE" />			<!--采购意见处理员编码 -->
		<result property="purchasebidName" column="PURCHASEBID_NAME" />			<!--采购竞价/议价员姓名 -->
		<result property="purchasebidCode" column="PURCHASEBID_CODE" />			<!--采购竞价/议价员编码 -->
		<result property="payeeCode" column="PAYEE_CODE" />			<!--收款确认员编码-->
		<result property="payeeName" column="PAYEE_NAME" />			<!--收款确认员姓名 -->



	</resultMap>

	<!-- oracle 分页头 -->
	<sql id="pagination_Head">
        <![CDATA[select * from ( select row_.*, rownum rownum_ from ( ]]>
	</sql>
	<!-- oracle 分页尾 -->
	<sql id="pagination_Tail">
        <![CDATA[) row_ where rownum <= #{pager.pageSize}* #{pager.offset} ) where rownum_ >= #{pager.firstResult} + 1]]>
	</sql>
	<!-- count * from -->
	<sql id="count_Start_Head">
		<![CDATA[select count(*) from ( ]]>
	</sql>
	<sql id="count_Start_Tail">
		<![CDATA[) countObj ]]>
	</sql>

	<sql id="search_fragment">

		SELECT
		CADDRESS_CODE,
		CADDRESS_NAME,
		CCREATE_BY,
		DCREATE_DATE,
		CUPDATE_BY,
		DUPDATE_DATE,
		CCREATE_BY_CODE,
		CUPDATE_BY_CODE,
		CMEMO,
		CSTATUS,
		RECEIVEGOODS_NAME,
		RECEIVEGOODS_CODE,
		RETIREDGOODS_NAME,
		RETIREDGOODS_CODE,
		PURCHASETIPACCESS_NAME,
		PURCHASETIPACCESS_CODE,
		PURCHASEBID_NAME,
		PURCHASEBID_CODE,
		PAYEE_CODE,
		PAYEE_NAME

		FROM TB_FA_WORK_ADDRESS
		WHERE 1 = 1
	</sql>
	<sql id="search_location_fragment">

		SELECT
		CADDRESS_CODE,
		CADDRESS_NAME
		FROM TB_FA_WORK_ADDRESS
		WHERE CSTATUS = 'Y'
	</sql>

	<sql id="search_fragment_cond">
		<if
			test="workAddress.caddressCode != null and workAddress.caddressCode != ''">
			AND CADDRESS_CODE LIKE '%' || TRIM(#{workAddress.caddressCode }) || '%'
		</if>
		<if
			test="workAddress.caddressName != null and workAddress.caddressName != ''">
			AND CADDRESS_NAME LIKE '%' || TRIM(#{workAddress.caddressName }) || '%'
		</if>
		
		<if
			test="workAddress.cupdateBy != null and workAddress.cupdateBy != ''">
			AND CUPDATE_BY LIKE '%' || TRIM(#{workAddress.cupdateBy }) || '%'
		</if>
		
		
		<if test="workAddress.cstatus != null and workAddress.cstatus != ''">
			AND CSTATUS = #{workAddress.cstatus}
		</if>
		<if
			test="workAddress.updateDateBegin != null and workAddress.updateDateBegin != ''">
			AND DUPDATE_DATE >=
			to_date(#{workAddress.updateDateBegin},'yyyy/mm/dd')
		</if>
		<if
			test="workAddress.updateDateEnd != null and workAddress.updateDateEnd != ''">
			AND DUPDATE_DATE <![CDATA[<=]]>to_date(#{workAddress.updateDateEnd},'yyyy/mm/dd')
		</if>
	</sql>

	<insert id="save">
		INSERT INTO TB_FA_WORK_ADDRESS
		(
		CADDRESS_CODE,
		CADDRESS_NAME,
		CCREATE_BY,
		DCREATE_DATE,
		CUPDATE_BY,
		DUPDATE_DATE,
		CCREATE_BY_CODE,
		CUPDATE_BY_CODE,
		CMEMO,
		CSTATUS,
		RECEIVEGOODS_CODE,
		RECEIVEGOODS_NAME,
		RETIREDGOODS_CODE,
		RETIREDGOODS_NAME,
		PURCHASETIPACCESS_CODE,
		PURCHASETIPACCESS_NAME,
		PURCHASEBID_CODE,
		PURCHASEBID_NAME,
		PAYEE_CODE,
		PAYEE_NAME
		)
		VALUES
		(
		#{workAddress.caddressCode },
		#{workAddress.caddressName },
		#{workAddress.ccreateBy },
		SYSDATE,
		#{workAddress.ccreateBy },
		SYSDATE,
		#{workAddress.ccreateByCode },
		#{workAddress.ccreateByCode },
		#{workAddress.cmemo },
		#{workAddress.cstatus },
		#{workAddress.receivegoodsCode },
		#{workAddress.receivegoodsName },
		#{workAddress.retiredgoodsCode },
		#{workAddress.retiredgoodsName },
		#{workAddress.purchasetipaccessCode },
		#{workAddress.purchasetipaccessName },
		#{workAddress.purchasebidCode },
		#{workAddress.purchasebidName },
		#{workAddress.payeeCode },
		#{workAddress.payeeName }

		)
	</insert>

	<!-- 批量插入 -->
	<insert id="saveBatch">
		INSERT INTO TB_FA_WORK_ADDRESS
		(
		CADDRESS_CODE,
		CADDRESS_NAME,
		CCREATE_BY,
		DCREATE_DATE,
		CUPDATE_BY,
		DUPDATE_DATE,
		CCREATE_BY_CODE,
		CUPDATE_BY_CODE,
		CMEMO,
		CSTATUS,
		RECEIVEGOODS_CODE,
		RECEIVEGOODS_NAME,
		RETIREDGOODS_CODE,
		RETIREDGOODS_NAME,
		PURCHASETIPACCESS_CODE,
		PURCHASETIPACCESS_NAME,
		PURCHASEBID_CODE,
		PURCHASEBID_NAME,
		PAYEE_CODE,
		PAYEE_NAME
		)
		VALUES
		<foreach collection="list" item="item" index="index"
			separator=",">
			(
			#{item.caddressCode },
			#{item.caddressName },
			#{item.ccreateBy },
			SYSDATE,
			#{item.ccreateBy },
			SYSDATE,
			#{item.ccreateByCode },
			#{item.ccreateByCode },
			#{item.cmemo },
			#{item.cstatus },
			#{item.receivegoodsCode },
			#{item.receivegoodsName },
			#{item.retiredgoodsCode },
			#{item.retiredgoodsName },
			#{item.purchasetipaccessCode },
			#{item.purchasetipaccessName },
			#{item.purchasebidCode },
			#{item.purchasebidName },
			#{workAddress.payeeCode },
			#{workAddress.payeeName }
			)
		</foreach>
	</insert>


	<!-- 删除-修改状态 -->
	<delete id="delete">
		UPDATE TB_FA_WORK_ADDRESS
		SET

		CSTATUS = #{workAddress.cstatus },
		CUPDATE_BY = #{workAddress.cupdateBy },
		CUPDATE_BY_CODE =
		#{workAddress.cupdateByCode },
		DUPDATE_DATE = SYSDATE
		WHERE
		CADDRESS_CODE IN
		<foreach collection="workAddress.caddressCodes" item="caddressCode"
			separator="," open="(" close=")">
			#{caddressCode }
		</foreach>
	</delete>

	<!-- 修改 -->
	<update id="update">
		UPDATE TB_FA_WORK_ADDRESS
		SET
		CADDRESS_NAME = #{workAddress.caddressName },
		CUPDATE_BY = #{workAddress.cupdateBy },
		CUPDATE_BY_CODE = #{workAddress.cupdateByCode },
		DUPDATE_DATE = SYSDATE,
		CMEMO = #{workAddress.cmemo },
		CSTATUS = #{workAddress.cstatus},
		RECEIVEGOODS_NAME=	#{workAddress.receivegoodsName },
		RECEIVEGOODS_CODE=	#{workAddress.receivegoodsCode },
		RETIREDGOODS_NAME=	#{workAddress.retiredgoodsName },
		RETIREDGOODS_CODE=	#{workAddress.retiredgoodsCode },
		PURCHASETIPACCESS_NAME=	#{workAddress.purchasetipaccessName },
		PURCHASETIPACCESS_CODE=	#{workAddress.purchasetipaccessCode },
		PURCHASEBID_NAME=	#{workAddress.purchasebidName },
		PURCHASEBID_CODE=	#{workAddress.purchasebidCode },
		PAYEE_CODE = #{workAddress.payeeCode },
		PAYEE_NAME = #{workAddress.payeeName }
		WHERE CADDRESS_CODE = #{workAddress.caddressCode }
	</update>

	<!-- 查询 -->
	<select id="get" resultMap="workAddressResultMap">
		<include refid="search_fragment" />
		AND CADDRESS_CODE = #{caddressCode }
	</select>

	<select id="searchList" resultMap="workAddressResultMap">
		<include refid="pagination_Head" />
		<include refid="search_fragment" />
		<include refid="search_fragment_cond" />
		<include refid="pagination_Tail" />
	</select>
	<select id="searchCodeAndName" resultMap="workAddressResultMap">
		<include refid="pagination_Head" />
		<include refid="search_location_fragment" />
		<include refid="search_fragment_cond" />
		<include refid="pagination_Tail" />
	</select>
	<select id="searchCodeAndNameCount" resultType="integer">
		SELECT COUNT(*)
		FROM TB_FA_WORK_ADDRESS
		WHERE CSTATUS = 'Y'
	</select>
	<select id="searchListCount" resultType="long">
		<include refid="count_Start_Head"/>
		SELECT CADDRESS_CODE
		FROM TB_FA_WORK_ADDRESS
		WHERE 1 = 1
		<include refid="search_fragment_cond"/>
		<include refid="count_Start_Tail"/>
	</select>

	<!-- 查询 -->
	<select id="getList" resultMap="workAddressResultMap">
		<include refid="search_fragment" />
		<include refid="search_fragment_cond" />
	</select>

	<!-- 查看编码是否存在 -->
	<select id="selectExistCodes" parameterType="java.util.List"
		resultType="string">
		SELECT CADDRESS_CODE FROM TB_FA_WORK_ADDRESS
		WHERE CADDRESS_CODE IN
		<foreach collection="caddressCodes" item="caddressCode"
			separator="," open="(" close=")">
			#{caddressCode }
		</foreach>
	</select>
	<select id="selectExistNames" parameterType="java.util.List"
			resultType="string">
		SELECT CADDRESS_NAME FROM TB_FA_WORK_ADDRESS
		WHERE CADDRESS_NAME IN
		<foreach collection="caddressNames" item="caddressName"
				 separator="," open="(" close=")">
			#{caddressName }
		</foreach>
	</select>

	<select id="checkUnitCode" resultType="long">
		select count(*) from TB_FA_WORK_ADDRESS
		where CADDRESS_CODE = #{caddressCode }
	</select>
	<!-- 查看名称是否存在 -->
	<select id="selectExistName" resultType="long">
		SELECT count(*) FROM TB_FA_WORK_ADDRESS
		WHERE
		CADDRESS_NAME = #{workAddress.caddressName }
		<if test="workAddress.caddressCode != null and workAdress.caddressCode != ''">
			AND CADDRESS_CODE != #{workAddress.caddressCode }
		</if>
	</select>
	<select id="selectCodeAndName" resultType="integer">
		SELECT count(*) FROM TB_FA_WORK_ADDRESS
		WHERE
		CADDRESS_NAME = #{caddressName }
		<if test="caddressName != null and caddressName != ''">
			AND CADDRESS_CODE != #{caddressCode }
		</if>
	</select>
	<select id="searchWorkAddress" resultType="long">
		select count(CADDRESS_NAME) from TB_FA_WORK_ADDRESS
		where
		CADDRESS_NAME = #{addressName } AND
		CADDRESS_CODE = #{addressCode}
		and CSTATUS='Y'

	</select>
</mapper>

