<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.opple.fa.sap.dao.PurchaseOrderSapDAO">
	<resultMap id="etZmm0012Map" type="etZmm0012">
		<result property="ebeln" column="PURCHASE_SAP_NO"/>
		<result property="ebelp" column="ITEM_NO"/>
		<result property="compCode" column="COMP_CODE"/>
		<result property="matnr" column="MATERIAL_NO"/>
		<result property="menge" column="COUNT"/>
		<result property="meins" column="UNIT"/>
		<result property="sakto" column="GL_ACCOUNT_NO"/>
		<result property="purchaseId" column="PURCHASE_ORDER_NO"/>
		<result property="assetNo" column="ASSET_NO"/>
		<result property="subNumber" column="SUB_NUMBER"/>
		<result property="etLog" column="ET_LOG"/>
		<result property="operateUser" column="OPERATE_USER"/>
		<result property="operateDate" column="OPERATE_DATE"/>
		<result property="purchaseId" column="PURCHASE_ID"/>
		<result property="purchaseDetailId" column="PURCHASE_DETAIL_ID"/>
		<result property="docType" column="DOC_TYPE"/>
	</resultMap>

	<insert id="save" parameterType="etZmm0012">
		insert into TB_FA_SAP_PURCHASE_ORDER
		(
		<!-- DOC_TYPE, -->
		COMP_CODE,
		PURCHASE_SAP_NO
		,ITEM_NO
		,MATERIAL_NO
		,UNIT
		,GL_ACCOUNT_NO
		,ASSET_NO
		,SUB_NUMBER
		<!-- ,ET_LOG -->
		,OPERATE_USER
		,OPERATE_DATE
		,PURCHASE_ID
		,PURCHASE_DETAIL_ID
		)
		values
		(
		#{etZmm0012.compCode},
		#{etZmm0012.ebeln },
		#{etZmm0012.ebelp },
		#{etZmm0012.matnr },
		#{etZmm0012.meins },
		#{etZmm0012.sakto },
		#{etZmm0012.assetNo },
		#{etZmm0012.subNumber },
		<!-- #{etZmm0012.etLog }, -->
		#{etZmm0012.operateUser },
		#{etZmm0012.operateDate },
		#{etZmm0012.purchaseId },
		#{etZmm0012.purchaseDetailId }
		)

	</insert>
	
		  <!-- 查看编码是否存在 -->
	<select id="selectExists" resultType="string" parameterType="string">
		SELECT PURCHASE_SAP_NO FROM(SELECT PURCHASE_SAP_NO FROM TB_FA_SAP_PURCHASE_ORDER
	    WHERE PURCHASE_ID = #{purchaseId } 
	    AND PURCHASE_SAP_NO IS NOT NULL  ORDER BY OPERATE_DATE DESC) WHERE ROWNUM = 1
	</select>
	<delete id="delete" parameterType="etZmm0012">
	 delete from tb_fa_sap_purchase_order t where t.purchase_id=#{etZmm0012.purchaseId } and t.purchase_detail_id=#{etZmm0012.purchaseDetailId }
	             and t.asset_no=#{etZmm0012.assetNo } and t.sub_number=#{etZmm0012.subNumber }
	</delete>
	
</mapper>

