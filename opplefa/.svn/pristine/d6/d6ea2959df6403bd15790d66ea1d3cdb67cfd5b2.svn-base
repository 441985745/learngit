<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.opple.fa.processasset.dao.ProcessAssetsDAO">
    <!-- oracle 分页头 -->
    <sql id="pagination_Head" >
        <![CDATA[select * from ( select row_.*, rownum rownum_ from ( ]]>
    </sql>
    <!-- oracle 分页尾 -->
    <sql id="pagination_Tail">
        <![CDATA[) row_ where rownum <= #{pager.pageSize}* #{pager.offset} ) where rownum_ >= #{pager.firstResult} + 1]]>
    </sql>
    <!-- count * from -->
	<sql id="count_Start_Head">
		<![CDATA[select count(*) from ( ]]>
	</sql>
	<sql id="count_Start_Tail">
		<![CDATA[) countObj ]]>
	</sql>
	<resultMap id="processAssetsMap" type="com.opple.fa.processasset.entity.ProcessAssets">
        <result property="id" column="ID"/>
        <result property="createBy" column="CREATE_BY"/>
        <result property="createDate" column="CREATE_DATE"/>
        <result property="updateBy" column="UPDATE_BY"/>
        <result property="updateDate" column="UPDATE_DATE"/>
        <result property="status" column="STATUS"/>
        <result property="document" column="CDOCUMENT"/>
        <result property="processAssetsCode" column="PROCESS_ASSETS_CODE"/>
        <result property="processAssetsName" column="PROCESS_ASSETS_NAME"/>
        <result property="applyPeople" column="APPLY_PEOPLE"/>
        <result property="applicationDate" column="APPLICATION_DATE"/>
        <result property="homeCompany" column="HOME_COMPANY"/>
        <result property="assetOwner" column="ASSET_OWNER"/>
        <result property="assetOwnerCode" column="ASSET_OWNER_CODE"/>
        <result property="homeCompanyCode" column="HOME_COMPANY_CODE"/>
        <result property="costCenter" column="COSTCENTER"/>
        <result property="platform" column="PLATFORM"/>
        <result property="storagePlace" column="STORAGE_PLACE" />
		<result property="assetType" column="ASSET_TYPE" />
		<result property="officeLocation" column="OFFICE_LOCATION" />
		<result property="workshopType" column="WORKSHOP_TYPE" />
		<result property="commitType" column="COMMIT_TYPE" />
		<result property="approvalState" column="CAPPROVALSTATE" />
		<result property="userCode" column="USER_CODE" />
		<result property="userName" column="USER_NAME" />
		<result property="companyCode" column="COMPANY_CODE"/>
        <result property="companyName" column="COMPANY_NAME" />
		<result property="departmentCode" column="DEPARTMENT_CODE" />
		<result property="departmentName" column="DEPARTMENT_NAME" />
		<result property="approvalEnd" column="CAPPROVALEND" />
		<result property="caUserCode" column="CAUSERCODE" />
		<result property="caUserName" column="CAUSERNAME" />
		<result property="userDepCode" column="USER_DEP_CODE" />
		<result property="nextHandlerCode" column="CNEXTHANDLERCODE" />
		<result property="nextHandlerName" column="CNEXTHANDLERNAME" />
		<result property="lastADate" column="DLASTADATE" />
		<result property="isMail" column="IS_MAIL" />
		<result property="isPhoneMessage" column="IS_PHONE_MESSAGE" />
		<result property="idea" column="IDEA" />
		<result property="costcenterName" column="COSTCENTER_NAME"/>
		<result property="assetCostcenterCode" column="ASSET_COSTCENTER_CODE"/>
		<result property="assetCostcenterName" column="ASSET_COSTCENTER_NAME"/>
		<result property="assetDepartmentCode" column="ASSET_DEPARTMENT_CODE"/>
		<result property="assetDepartmentName" column="ASSET_DEPARTMENT_NAME"/>
		<result property="originalValueSum" column="ORIGINAL_VALUE_SUM"/>
		<result property="assetNetValueSum" column="ASSET_NET_VALUE_SUM"/>
		<result property="cause" column="CAUSE"/>
		

	</resultMap>
	
	<sql id="search_process_assets" >
        <![CDATA[
               SELECT
					 ID,
					 CREATE_BY,
					 CREATE_DATE,
					 UPDATE_BY,
					 UPDATE_DATE,
					 STATUS,
					 CDOCUMENT,
					 PROCESS_ASSETS_CODE,
					 PROCESS_ASSETS_NAME,
					 APPLY_PEOPLE,
					 APPLICATION_DATE,
					 HOME_COMPANY,
					 ASSET_OWNER,
					 COSTCENTER,
					 PLATFORM,
					 STORAGE_PLACE,
					 ASSET_TYPE,
					 OFFICE_LOCATION,
					 WORKSHOP_TYPE,
					 COMMIT_TYPE,
					 CAPPROVALSTATE,
					 USER_CODE,
					 USER_NAME,
					 COMPANY_CODE,
					 COMPANY_NAME,
					 DEPARTMENT_CODE,
					 DEPARTMENT_NAME,
					 CAPPROVALEND,
					 CAUSERCODE,
					 CAUSERNAME,
					 USER_DEP_CODE,
					 CNEXTHANDLERCODE,
					 CNEXTHANDLERNAME,
					 DLASTADATE,
					 IS_MAIL,
					 IS_PHONE_MESSAGE,
					 IDEA,
					 ASSET_OWNER_CODE,
					 HOME_COMPANY_CODE,
					 COSTCENTER_NAME,
					 ASSET_COSTCENTER_CODE,
					 ASSET_COSTCENTER_NAME,
					 ASSET_DEPARTMENT_CODE,
					 ASSET_DEPARTMENT_NAME,
					 ORIGINAL_VALUE_SUM,
					 ASSET_NET_VALUE_SUM,
					 CAUSE
	
				FROM
					 TB_FA_PROCESS_ASSETS
        ]]>
    </sql>
    
    <update id="deleteProcessAssets" parameterType="com.opple.fa.processasset.entity.ProcessAssets">
    
    	update TB_FA_PROCESS_ASSETS set STATUS='1' where ID=#{processAssets.id}
    	
    </update>
    
    <update id="updateProcessAssets">
    
    	update TB_FA_PROCESS_ASSETS set 

		 UPDATE_BY=#{processAssets.updateBy},
		 UPDATE_DATE=#{processAssets.updateDate},
		 STATUS='0',
		 CDOCUMENT=#{processAssets.document},
		 PROCESS_ASSETS_CODE=#{processAssets.processAssetsCode},
		 PROCESS_ASSETS_NAME=#{processAssets.processAssetsName},
		 APPLY_PEOPLE=#{processAssets.applyPeople},
		 APPLICATION_DATE=#{processAssets.applicationDate},
		 HOME_COMPANY=#{processAssets.homeCompany},
		 ASSET_OWNER=#{processAssets.assetOwner},
		 COSTCENTER=#{processAssets.costCenter},
		 PLATFORM=#{processAssets.platform},
		 STORAGE_PLACE=#{processAssets.storagePlace},
		 ASSET_TYPE=#{processAssets.assetType},
		 OFFICE_LOCATION=#{processAssets.officeLocation},
		 WORKSHOP_TYPE=#{processAssets.workshopType},
		 COMMIT_TYPE=#{processAssets.commitType},
		 CAPPROVALSTATE=#{processAssets.approvalState},
		 USER_CODE=#{processAssets.userCode},
		 USER_NAME=#{processAssets.userName},
		 COMPANY_CODE=#{processAssets.companyCode},
		 COMPANY_NAME=#{processAssets.companyName},
		 DEPARTMENT_CODE=#{processAssets.departmentCode},
		 DEPARTMENT_NAME=#{processAssets.departmentName},
		 CAPPROVALEND=#{processAssets.approvalEnd},
		 CAUSERCODE=#{processAssets.caUserCode},
		 CAUSERNAME=#{processAssets.caUserName},
		 USER_DEP_CODE=#{processAssets.userDepCode},
		 CNEXTHANDLERCODE=#{processAssets.nextHandlerCode},
		 CNEXTHANDLERNAME=#{processAssets.nextHandlerName},
		 DLASTADATE=#{processAssets.lastADate},
		 IS_MAIL=#{processAssets.isMail},
		 IS_PHONE_MESSAGE=#{processAssets.isPhoneMessage},
		 IDEA=#{processAssets.idea},
		 ASSET_OWNER_CODE=#{processAssets.assetOwnerCode},
		 HOME_COMPANY_CODE=#{processAssets.homeCompanyCode},
		 COSTCENTER_NAME=#{processAssets.costcenterName},
		 ASSET_COSTCENTER_CODE=#{processAssets.assetCostcenterCode},
		 ASSET_COSTCENTER_NAME=#{processAssets.assetCostcenterName},
		 ASSET_DEPARTMENT_CODE=#{processAssets.assetDepartmentCode},
		 ASSET_DEPARTMENT_NAME=#{processAssets.assetDepartmentName},
		 ORIGINAL_VALUE_SUM=#{processAssets.originalValueSum},
		 ASSET_NET_VALUE_SUM=#{processAssets.assetNetValueSum},
		 CAUSE=#{processAssets.cause}

		 where ID=#{processAssets.id}
  	
    
    </update>
    
    <insert id="saveProcessAssets" keyProperty="id" useGeneratedKeys="true" parameterType="com.opple.fa.processasset.entity.ProcessAssets">
    	<selectKey keyProperty="id"  order="BEFORE" resultType="long">
			select seq_process_assets.nextval as id from dual
		</selectKey>
    	INSERT INTO  TB_FA_PROCESS_ASSETS
			( 	
				ID,
				CREATE_BY,
				CREATE_DATE,
				UPDATE_BY,
				UPDATE_DATE,
				STATUS,
				CDOCUMENT,
				PROCESS_ASSETS_CODE,
				PROCESS_ASSETS_NAME,
				APPLY_PEOPLE,
				APPLICATION_DATE,
				HOME_COMPANY,
				ASSET_OWNER,
				COSTCENTER,
				PLATFORM,
				STORAGE_PLACE,
				ASSET_TYPE,
				OFFICE_LOCATION,
				WORKSHOP_TYPE,
				COMMIT_TYPE,
				CAPPROVALSTATE,
				USER_CODE,
				USER_NAME,
				COMPANY_CODE,
				COMPANY_NAME,
				DEPARTMENT_CODE,
				DEPARTMENT_NAME,
				CAUSERCODE,
				CAUSERNAME,
				USER_DEP_CODE,
				CNEXTHANDLERCODE,
				CNEXTHANDLERNAME,
				DLASTADATE,
				IS_MAIL,
				IS_PHONE_MESSAGE,
				IDEA,
				ASSET_OWNER_CODE,
				HOME_COMPANY_CODE,
			 	COSTCENTER_NAME,
		 		ASSET_COSTCENTER_CODE,
				ASSET_COSTCENTER_NAME,
		 		ASSET_DEPARTMENT_CODE,
		 		ASSET_DEPARTMENT_NAME,
		 		ORIGINAL_VALUE_SUM,
		 		ASSET_NET_VALUE_SUM,
		 		CAUSE

			)VALUES(
				
				#{id},
				#{createBy},
				#{createDate},
				#{updateBy},
				#{updateDate},
				'0',
				#{document},
				#{processAssetsCode},
				#{processAssetsName},
				#{applyPeople},
				#{applicationDate},
				#{homeCompany},
				#{assetOwner},
				#{costCenter},
				#{platform},
				#{storagePlace},
				#{assetType},
				#{officeLocation},
				#{workshopType},
				#{commitType},
				#{approvalState},
				#{userCode},
				#{userName},
				#{companyCode},
				#{companyName},
				#{departmentCode},
				#{departmentName},
				#{caUserCode},
				#{caUserName},
				#{userDepCode},
				#{nextHandlerCode},
				#{nextHandlerName},
				#{lastADate},
				#{isMail},
				#{isPhoneMessage},
				#{idea},
				#{assetOwnerCode},
				#{homeCompanyCode},
				#{costcenterName},
				#{assetCostcenterCode},
				#{assetCostcenterName},
				#{assetDepartmentCode},
				#{assetDepartmentName},
				#{originalValueSum},
				#{assetNetValueSum},
				#{cause}

			)
    	
    </insert>
    
    <select id="getProcessAssets" resultMap="processAssetsMap" parameterType="com.opple.fa.processasset.entity.ProcessAssets" >
    	<include refid="search_process_assets"/>
    	WHERE STATUS = '0' AND ID=#{processAssets.id}
    </select>
    
    <select id="searchProcessAssets" resultMap="processAssetsMap" parameterType="com.opple.fa.processasset.entity.ProcessAssets" >
    	<include refid="pagination_Head"/>
    	<include refid="search_process_assets"/>
    	WHERE STATUS = '0'
    	<if test="processAssets.start != null and processAssets.start != ''">
			<![CDATA[ AND APPLICATION_DATE >= #{processAssets.start} ]]>
		</if>
		<if test="processAssets.end != null and processAssets.end != ''">
			<![CDATA[ AND APPLICATION_DATE <= #{processAssets.end} ]]>
	    </if>
	    <if test="processAssets.userName != null and processAssets.userName != ''">
			AND (USER_NAME LIKE '%' || #{processAssets.userName} || '%' OR USER_CODE LIKE '%' || #{processAssets.userName} || '%') 
		</if>
    	<if test="processAssets.document != null and processAssets.document != ''">
			AND CDOCUMENT LIKE '%' || #{processAssets.document} || '%' 
		</if>
    	<if test="processAssets.processAssetsName != null and processAssets.processAssetsName != ''">
			AND PROCESS_ASSETS_NAME LIKE '%' || #{processAssets.processAssetsName} || '%' 
		</if>
		<if test="processAssets.assetOwner != null and processAssets.assetOwner != ''">
			AND ASSET_OWNER LIKE '%' || #{processAssets.assetOwner} || '%' 
		</if>
		<if test="processAssets.assetType != null and processAssets.assetType != ''">
			AND ASSET_TYPE LIKE '%' || #{processAssets.assetType} || '%' 
		</if>
		<if test="processAssets.assetCostcenterName != null and processAssets.assetCostcenterName != ''">
			AND (ASSET_COSTCENTER_CODE LIKE '%' || #{processAssets.assetCostcenterName} || '%'  or ASSET_COSTCENTER_NAME LIKE '%' || #{processAssets.assetCostcenterName} || '%' )
		</if>
		<if test="processAssets.homeCompany != null and processAssets.homeCompany != ''">
			AND (HOME_COMPANY LIKE '%' || #{processAssets.homeCompany} || '%'  or HOME_COMPANY_CODE LIKE '%' || #{processAssets.homeCompany} || '%' )
		</if>
		<if test="processAssets.commitType != null and processAssets.commitType != ''">
			AND COMMIT_TYPE  = #{processAssets.commitType} 
		</if>
		<if test="processAssets.assetCode !=null and processAssets.assetCode != ''">
			AND ID in (select t.PROCESS_ASSETS_ID from tb_fa_process_assets_detall t  where  t.STATUS='0' and t.GENERAL_ASSET_ID  in (select g.ID from tb_fa_general_asset g where g.ASSET_CODE  LIKE '%' || #{processAssets.assetCode} || '%'))
		</if>
		ORDER BY ID DESC
    	<include refid="pagination_Tail"/>
    </select>
	
	<select id="searchProcessAssetsCount" resultType="long" parameterType="com.opple.fa.processasset.entity.ProcessAssets">
    	<include refid="count_Start_Head"/>
    	<include refid="search_process_assets"/>
    	WHERE STATUS = '0'
    	<if test="processAssets.start != null and processAssets.start != ''">
			<![CDATA[ AND APPLICATION_DATE >= #{processAssets.start} ]]>
		</if>
		<if test="processAssets.end != null and processAssets.end != ''">
			<![CDATA[ AND APPLICATION_DATE <= #{processAssets.end} ]]>
	    </if>
	    <if test="processAssets.applyPeople != null and processAssets.applyPeople != ''">
			AND APPLY_PEOPLE LIKE '%' || #{processAssets.applyPeople} || '%' 
		</if>
    	<if test="processAssets.processAssetsCode != null and processAssets.processAssetsCode != ''">
			AND PROCESS_ASSETS_CODE LIKE '%' || #{processAssets.processAssetsCode} || '%' 
		</if>
    	<if test="processAssets.processAssetsName != null and processAssets.processAssetsName != ''">
			AND PROCESS_ASSETS_NAME LIKE '%' || #{processAssets.processAssetsName} || '%' 
		</if>
		<if test="processAssets.assetOwner != null and processAssets.assetOwner != ''">
			AND ASSET_OWNER LIKE '%' || #{processAssets.assetOwner} || '%' 
		</if>
		<if test="processAssets.assetType != null and processAssets.assetType != ''">
			AND ASSET_TYPE LIKE '%' || #{processAssets.assetType} || '%' 
		</if>
		<if test="processAssets.assetCostcenterName != null and processAssets.assetCostcenterName != ''">
			AND (ASSET_COSTCENTER_CODE LIKE '%' || #{processAssets.assetCostcenterName} || '%'  or ASSET_COSTCENTER_NAME LIKE '%' || #{processAssets.assetCostcenterName} || '%' )
		</if>
		<if test="processAssets.homeCompany != null and processAssets.homeCompany != ''">
			AND (HOME_COMPANY LIKE '%' || #{processAssets.homeCompany} || '%'  or HOME_COMPANY_CODE LIKE '%' || #{processAssets.homeCompany} || '%' )
		</if>
		<if test="processAssets.commitType != null and processAssets.commitType != ''">
			AND COMMIT_TYPE  = #{processAssets.commitType} 
		</if>
		<if test="processAssets.assetCode !=null and processAssets.assetCode != ''">
			AND ID in (select t.PROCESS_ASSETS_ID from tb_fa_process_assets_detall t  where  t.STATUS='0' and t.GENERAL_ASSET_ID  in (select g.ID from tb_fa_general_asset g where g.ASSET_CODE  LIKE '%' || #{processAssets.assetCode} || '%'))
		</if>
		ORDER BY ID DESC
    	<include refid="count_Start_Tail"/>
    </select>
    
    
    <select id="export" resultMap="processAssetsMap" parameterType="com.opple.fa.processasset.entity.ProcessAssets">
    
    	<include refid="search_process_assets"/>
    	WHERE STATUS = '0'
    	
    	<if test="processAssets.processAssetsCode != null and processAssets.processAssetsCode != ''">
			AND PROCESS_ASSETS_CODE LIKE '%' || #{processAssets.processAssetsCode} || '%' 
		</if>
    	<if test="processAssets.processAssetsName != null and processAssets.processAssetsName != ''">
			AND PROCESS_ASSETS_NAME LIKE '%' || #{processAssets.processAssetsName} || '%' 
		</if>
		<if test="processAssets.assetOwner != null and processAssets.assetOwner != ''">
			AND ASSET_OWNER LIKE '%' || #{processAssets.assetOwner} || '%' 
		</if>
		<if test="processAssets.workshopType != null and processAssets.workshopType != ''">
			AND WORKSHOP_TYPE LIKE '%' || #{processAssets.workshopType} || '%' 
		</if>
		<if test="processAssets.storagePlace != null and processAssets.storagePlace != ''">
			AND STORAGE_PLACE LIKE '%' || #{processAssets.storagePlace} || '%' 
		</if>
		ORDER BY ID DESC
    
    </select>
    <delete id="deleteProcessAssetsByDocument">
		DELETE FROM TB_FA_PROCESS_ASSETS WHERE CDOCUMENT = #{document}
	</delete>
	<select id="getProcessAssetsByDocument" parameterType="com.opple.fa.processasset.entity.ProcessAssets" resultMap="processAssetsMap">
		select * from TB_FA_PROCESS_ASSETS where CDOCUMENT=#{document} and  STATUS='0'
	</select>
</mapper>